<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€€è€€å·¥å‚ - æƒé™ç®¡ç†åå°</title>
    <link rel="stylesheet" href="permission-admin.css">
    <style>
        /* æ·»åŠ åˆ°ç°æœ‰æ ·å¼è¡¨æˆ–æ·»åŠ åˆ°<head>éƒ¨åˆ† */
        .action-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* å¯ä»¥æ·»åŠ å®é™…ç¦ç”¨çŠ¶æ€çš„æ ·å¼ */
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* æ·»åŠ ä¸€ä¸ªæ ·å¼ï¼Œç”¨äºå½“å¤é€‰æ¡†å¤„äºindeterminateçŠ¶æ€æ—¶æ›´æ”¹å¤–è§‚ */
        input[type="checkbox"]:indeterminate {
            background-color: #e0e0e0;
            border-color: #999;
        }
        
        /* æ·»åŠ åˆ°ç°æœ‰æ ·å¼ */
        input[type="checkbox"]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #f0f0f0;
        }
        
        /* å¯ä»¥ä¸ºå·²å¤„ç†è¡Œæ·»åŠ ä¸€ä¸ªè½»å¾®çš„èƒŒæ™¯è‰² */
        #approval-tab tbody tr:has(td:nth-child(9) .status-approved),
        #approval-tab tbody tr:has(td:nth-child(9) .status-rejected) {
            background-color: #f9f9f9;
        }

        /* çŠ¶æ€æ ‡ç­¾ - æ¢å¤åŸå§‹æ ·å¼ */
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 2px;
            font-size: 12px;
        }

        .status-pending {
            background-color: #faad14;
            color: white;
        }

        .status-approved {
            background-color: #52c41a;
            color: white;
        }

        .status-rejected {
            background-color: #f5222d;
            color: white;
        }
        
        /* å‚è€ƒsystem-logs.cssä¸­çš„detail-remarksæ ·å¼ */
        .detail-remarks {
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 12px;
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-top: 6px;
            border-left: 3px solid #e6f7ff;
        }
        
        /* ç”³è¯·åŸå› æ ·å¼ */
        .detail-section:nth-of-type(2) .detail-remarks {
            border-left-color: #faad14;
            background-color: #fffbe6;
        }
        
        /* å®¡æ‰¹é€šè¿‡å¤‡æ³¨æ ·å¼ */
        .detail-section:nth-of-type(3) .detail-remarks.approved {
            border-left-color: #52c41a;
            background-color: #f6ffed;
        }
        
        /* å®¡æ‰¹æ‹’ç»ç†ç”±æ ·å¼ */
        .detail-section:nth-of-type(3) .detail-remarks.rejected {
            border-left-color: #f5222d;
            background-color: #fff1f0;
        }
        
        /* æ‰¹é‡æ“ä½œæŒ‰é’®ç¦ç”¨çŠ¶æ€æ ·å¼ */
        .batch-actions .action-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        /* æ•°é‡æŒ‡ç¤ºå™¨æ ·å¼ */
        .count-indicator {
            display: inline-block;
            background-color: #1890ff;
            color: white;
            border-radius: 12px;
            padding: 0px 8px;
            font-size: 12px;
            line-height: 20px;
            margin-left: 5px;
            vertical-align: middle;
        }
        
        /* ä¼˜åŒ–ç™»å½•è®°å½•è¡¨æ ¼æ ·å¼ */
        .detail-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            table-layout: fixed;
        }
        
        .detail-table th, 
        .detail-table td {
            border: 1px solid #f0f0f0;
            padding: 8px 12px;
            text-align: left;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .detail-table th {
            background-color: #fafafa;
            font-weight: 500;
            color: #666;
        }
        
        /* è®¾ç½®åˆ—å®½åº¦ */
        .detail-table th:first-child,
        .detail-table td:first-child {
            width: 40%;  /* ç™»å½•æ—¶é—´åˆ—å®½ */
        }
        
        .detail-table th:nth-child(2),
        .detail-table td:nth-child(2) {
            width: 35%;  /* ç™»å½•è®¾å¤‡åˆ—å®½ */
        }
        
        .detail-table th:last-child,
        .detail-table td:last-child {
            width: 25%;  /* IPåœ°å€åˆ—å®½ */
        }
        
        .detail-table tbody tr:hover {
            background-color: #f5f7fa;
        }
        
        /* åˆ†é¡µé€‰æ‹©å™¨æ ·å¼ */
        .pagination-options {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }
        
        .pagination-options select {
            margin: 0 5px;
            padding: 5px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
        }
        
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        .pagination {
            display: flex;
        }
        
        /* ç®¡ç†å¹³å°å¤šé€‰æ¡†æ ·å¼ */
        #manage-platform-select {
            width: 100%;
        }
        
        #manage-platform-select .multi-select-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
        }
        
        #manage-platform-select .multi-select-header.active {
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }
        
        #manage-platform-select .multi-select-dropdown {
            display: none;
            position: absolute;
            width: 100%;
            max-height: 250px;
            overflow-y: auto;
            background-color: white;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            margin-top: 2px;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        #manage-platform-select .multi-select-dropdown.active {
            display: block;
        }
        
        #manage-platform-select .multi-select-option {
            padding: 8px 12px;
            cursor: pointer;
        }
        
        #manage-platform-select .multi-select-option:hover {
            background-color: #f5f5f5;
        }
        
        #manage-platform-select .multi-select-option input {
            margin-right: 8px;
        }
        
        /* å¼ºåˆ¶ç®¡ç†å¹³å°å¤šé€‰æ¡†åœ¨å¹³å°ç®¡ç†å‘˜è§’è‰²é€‰ä¸­æ—¶æ˜¾ç¤º */
        #add-user-modal input[name="role"][value="platform-admin"]:checked ~ #step-confirm .form-group:has(#manage-platform-select) {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* ç¡®ä¿ç®¡ç†å¹³å°ä¸‹æ‹‰æ¡†çš„æ ·å¼æ­£ç¡® */
        #manage-platform-select {
            position: relative;
            width: 100%;
        }
        
        #manage-platform-select .multi-select-dropdown {
            width: 100%;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="logo.png" alt="è€€è€€å·¥å‚">
                </div>
                <h2>è€€è€€å·¥å‚</h2>
            </div>
            <div class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <i>ğŸ“Š</i>
                    <span>ç³»ç»Ÿæ¦‚è§ˆ</span>
                </a>
                <a href="permission-admin.html" class="nav-item active">
                    <i>ğŸ”‘</i>
                    <span>æƒé™ç®¡ç†</span>
                </a>
                <a href="system-logs.html" class="nav-item">
                    <i>ğŸ“</i>
                    <span>ç³»ç»Ÿæ—¥å¿—</span>
                </a>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆª -->
            <div class="top-nav">
                <div class="breadcrumb">
                    æƒé™ç®¡ç†
                </div>
                <div class="user-profile">
                    <div class="user-info" onclick="toggleUserMenu()">
                        <div class="avatar">æˆ´</div>
                        <span class="username">ç®¡ç†å‘˜-æˆ´å€šå‡¡</span>
                        <i class="dropdown-icon">â–¼</i>
                    </div>
                    <div class="user-menu" id="userMenu">
                        <div class="menu-item" onclick="logout()">
                            <i class="menu-icon">â†©</i>
                            <span>é€€å‡ºç™»å½•</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ ‡ç­¾é¡µ -->
            <div class="tabs">
                <div class="tab-item" onclick="showTab('approval')">æƒé™å®¡æ‰¹</div>
                <div class="tab-item active" onclick="showTab('authorized')">å·²æˆæƒç”¨æˆ·</div>
<!--                <div class="tab-item" onclick="showTab('active')">å½“å‰ç™»å½•ç”¨æˆ·</div>-->
            </div>

            <!-- æƒé™å®¡æ‰¹å†…å®¹å¡ç‰‡ -->
            <div id="approval-tab" class="card tab-content" style="display: none;">
                <div class="card-header">
                    <h3 class="card-title">æƒé™ç”³è¯·åˆ—è¡¨</h3>
                </div>
                <div class="card-body">
                    <!-- ç­›é€‰åŒºåŸŸ -->
                    <div class="filter-area">
                        <div class="filter-item">
                            <label>å§“å:</label>
                            <input type="text" placeholder="è¯·è¾“å…¥å§“å">
                        </div>
                        <div class="filter-item">
                            <label>åŸŸè´¦å·:</label>
                            <input type="text" placeholder="è¯·è¾“å…¥åŸŸè´¦å·">
                        </div>
                        <div class="filter-item">
                            <label>éƒ¨é—¨:</label>
                            <select>
                                <option value="">å…¨éƒ¨</option>
                                <option value="info">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</option>
                                <option value="house">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æˆ¿å±‹å…¬å¸-æˆ¿å±‹å…¬å¸åœ˜éšŠï¼ˆé§æ·±ï¼‰</option>
                                <option value="haihong">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨</option>
                                <option value="hr">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-äººåŠ›èµ„æºéƒ¨éƒ¨éƒ¨éƒ¨</option>
                                <option value="finance">ä¸­åœ‹å»ºç¯‰åœ‹éš›-é‡‘èæ¥­å‹™éƒ¨</option>
                                <option value="macau">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºæ¾³é–€-æ€»éƒ¨éƒ¨é—¨-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>ç”³è¯·æ—¶é—´:</label>
                            <input type="date" class="date-picker">
                            <span class="date-separator">è‡³</span>
                            <input type="date" class="date-picker">
                        </div>
                        <div class="filter-item">
                            <label>å®¡æ‰¹çŠ¶æ€:</label>
                            <select>
                                <option value="">å…¨éƒ¨</option>
                                <option value="pending">å¾…å®¡æ‰¹</option>
                                <option value="approved">å·²é€šè¿‡</option>
                                <option value="rejected">å·²æ‹’ç»</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>å¹³å°:</label>
                            <div class="multi-select" id="approval-platform-filter">
                                <div class="multi-select-header">
                                    <span>å…¨éƒ¨</span>
                                    <span class="arrow">â–¼</span>
                                </div>
                                <div class="multi-select-dropdown">
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="ä¸€" checked> ç¬¬ä¸€å¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="äºŒ" checked> ç¬¬äºŒå¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="ä¸‰" checked> ç¬¬ä¸‰å¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="å››" checked> ç¬¬å››å¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="äº”" checked> ç¬¬äº”å¹³å°
                                    </div>
                                </div>
                            </div>
                        </div>
<!--                        <div class="filter-item">-->
<!--                            <label>è§’è‰²:</label>-->
<!--                            <div class="multi-select" id="approval-role-filter">-->
<!--                                <div class="multi-select-header">-->
<!--                                    <span>å…¨éƒ¨</span>-->
<!--                                    <span class="arrow">â–¼</span>-->
<!--                                </div>-->
<!--                                <div class="multi-select-dropdown">-->
<!--                                    <div class="multi-select-option">-->
<!--                                    <input type="checkbox" value="user" checked> æ™®é€šç”¨æˆ·-->
<!--                                </div>-->
<!--                                    <div class="multi-select-option">-->
<!--                                    <input type="checkbox" value="platform-admin" checked> å¹³å°ç®¡ç†å‘˜-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
                        <div class="filter-item">
                            <button class="search-btn">æœç´¢</button>
                            <button class="reset-btn">é‡ç½®</button>
                        </div>
                    </div>

                    <!-- æ‰¹é‡æ“ä½œ -->
                    <div class="batch-actions">
                        <button class="action-btn approve-btn">æ‰¹é‡é€šè¿‡</button>
                        <button class="action-btn reject-btn">æ‰¹é‡æ‹’ç»</button>
                    </div>

                    <!-- è¡¨æ ¼å†…å®¹ -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th><input type="checkbox"></th>
                                    <th>å§“å</th>
                                    <th>åŸŸè´¦å·</th>
                                    <th>éƒ¨é—¨</th>
                                    <th>å¹³å°</th>
                                    <th>è§’è‰²</th>
                                    <th>ç”³è¯·æ—¶é—´<span style="color: red">(é»˜è®¤å€’åºæ’åˆ—)</span></th>
                                    <th>ç”³è¯·ç†ç”±</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>å¼ ä¸‰</td>
                                    <td>zhangsan</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨</td>
                                    <td><span class="platform-badge platform-1">ç¬¬ä¸€å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2025-04-25 14:30</td>
                                    <td>éœ€è¦ä½¿ç”¨AIå·¥å…·æå‡å·¥ä½œæ•ˆç‡</td>
                                    <td><span class="status status-pending">å¾…å®¡æ‰¹</span></td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn approve-btn">é€šè¿‡</button>
                                        <button class="action-btn reject-btn">æ‹’ç»</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>æå››</td>
                                    <td>lisi</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</td>
                                    <td><span class="platform-badge platform-2">ç¬¬äºŒå¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2025-04-24 10:15</td>
                                    <td>éœ€è¦è°ƒç ”AIäº§å“åŠŸèƒ½</td>
                                    <td><span class="status status-pending">å¾…å®¡æ‰¹</span></td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn approve-btn">é€šè¿‡</button>
                                        <button class="action-btn reject-btn">æ‹’ç»</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>ç‹äº”</td>
                                    <td>wangwu</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</td>
                                    <td><span class="platform-badge platform-3">ç¬¬ä¸‰å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2025-04-23 10:00</td>
                                    <td>äº§å“è®¾è®¡éœ€è¦ä½¿ç”¨AIåŠ©æ‰‹</td>
                                    <td><span class="status status-approved">å·²é€šè¿‡</span></td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <!-- <button class="action-btn remove-btn">æ‹’ç»</button> -->
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>èµµå…­</td>
                                    <td>zhaoliu</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-äººåŠ›èµ„æºéƒ¨éƒ¨éƒ¨</td>
                                    <td><span class="platform-badge platform-4">ç¬¬å››å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2025-04-22 09:30</td>
                                    <td>éƒ¨é—¨éœ€å¼€å‘é—®ç­”æ™ºèƒ½ä½“ï¼Œçƒ¦è¯·å®¡æ‰¹</td>
                                    <td><span class="status status-rejected">å·²æ‹’ç»</span></td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <!-- <button class="action-btn approve-btn">é€šè¿‡</button> -->
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>é’±ä¸ƒ</td>
                                    <td>qianqi</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨</td>
                                    <td><span class="platform-badge platform-5">ç¬¬äº”å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2025-04-21 09:30</td>
                                    <td>å¼€å‘éœ€è¦ä½¿ç”¨AIæ¥å£</td>
                                    <td><span class="status status-pending">å¾…å®¡æ‰¹</span></td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn approve-btn">é€šè¿‡</button>
                                        <button class="action-btn reject-btn">æ‹’ç»</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- åˆ†é¡µ -->
                    <div class="pagination">
                        <button>&lt;</button>
                        <button class="active">1</button>
                        <button>2</button>
                        <button>3</button>
                        <button>&gt;</button>
                    </div>
                </div>
            </div>

            <!-- å·²æˆæƒç”¨æˆ·å†…å®¹å¡ç‰‡ -->
            <div id="authorized-tab" class="card tab-content">
                <div class="card-header">
                    <h3 class="card-title">å·²æˆæƒç”¨æˆ·åˆ—è¡¨</h3>
                    <button class="add-btn"  onclick="showAddUserModal()"">+ æ·»åŠ ç”¨æˆ·æƒé™</button>
                </div>
                <div class="card-body">
                    <!-- ç­›é€‰åŒºåŸŸ -->
                    <div class="filter-area">
                        <div class="filter-item">
                            <label>å§“å:</label>
                            <input type="text" placeholder="è¯·è¾“å…¥å§“å">
                        </div>
                        <div class="filter-item">
                            <label>åŸŸè´¦å·:</label>
                            <input type="text" placeholder="è¯·è¾“å…¥åŸŸè´¦å·">
                        </div>
                        <div class="filter-item">
                            <label>éƒ¨é—¨:</label>
                            <select>
                                <option value="">å…¨éƒ¨</option>
                                <option value="info">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</option>
                                <option value="house">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æˆ¿å±‹å…¬å¸-æˆ¿å±‹å…¬å¸åœ˜éšŠï¼ˆé§æ·±ï¼‰</option>
                                <option value="haihong">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨</option>
                                <option value="hr">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-äººåŠ›èµ„æºéƒ¨éƒ¨éƒ¨éƒ¨</option>
                                <option value="finance">ä¸­åœ‹å»ºç¯‰åœ‹éš›-é‡‘èæ¥­å‹™éƒ¨</option>
                                <option value="macau">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºæ¾³é–€-æ€»éƒ¨éƒ¨é—¨-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>æˆæƒæ—¶é—´:</label>
                            <input type="date" class="date-picker">
                            <span class="date-separator">è‡³</span>
                            <input type="date" class="date-picker">
                        </div>
                        <div class="filter-item">
                            <label>å¹³å°:</label>
                            <div class="multi-select" id="authorized-platform-filter">
                                <div class="multi-select-header">
                                    <span>å…¨éƒ¨</span>
                                    <span class="arrow">â–¼</span>
                                </div>
                                <div class="multi-select-dropdown">
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="ä¸€" checked> ç¬¬ä¸€å¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="äºŒ" checked> ç¬¬äºŒå¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="ä¸‰" checked> ç¬¬ä¸‰å¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="å››" checked> ç¬¬å››å¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="äº”" checked> ç¬¬äº”å¹³å°
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-item">
                            <label>è§’è‰²:</label>
                            <div class="multi-select" id="authorized-role-filter">
                                <div class="multi-select-header">
                                    <span>å…¨éƒ¨</span>
                                    <span class="arrow">â–¼</span>
                                </div>
                                <div class="multi-select-dropdown">
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="user" checked> æ™®é€šç”¨æˆ·
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="platform-admin" checked> å¹³å°ç®¡ç†å‘˜
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="admin" checked> è¶…çº§ç®¡ç†å‘˜
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-item filter-buttons">
                            <button class="search-btn">æœç´¢</button>
                            <button class="reset-btn">é‡ç½®</button>
                        </div>
                    </div>

                    <!-- æ·»åŠ æ‰¹é‡æ“ä½œåŒºåŸŸ -->
                    <div class="batch-actions">
                        <button class="action-btn remove-btn">æ‰¹é‡æ”¶å›æƒé™</button>
                    </div>

                    <!-- è¡¨æ ¼å†…å®¹ -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th><input type="checkbox"></th>
                                    <th>å§“å</th>
                                    <th>åŸŸè´¦å·</th>
                                    <th>éƒ¨é—¨</th>
                                    <th>å¹³å°</th>
                                    <th>è§’è‰²</th>
                                    <th>æˆæƒæ—¶é—´<span style="color: red">(é»˜è®¤å€’åºæ’åˆ—)</span></th>
                                    <th>æœ€è¿‘ç™»å½•</th>
<!--                                    <th>è®¿é—®æ¬¡æ•°</th>-->
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>å¼ ä¸‰</td>
                                    <td>zhangsan</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨</td>
                                    <td><span class="platform-badge platform-1">ç¬¬ä¸€å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2025-04-25 08:28</td>
                                    <td>2025-04-25 14:30</td>
<!--                                    <td>42æ¬¡</td>-->
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn remove-btn">æ”¶å›æƒé™</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>æå››</td>
                                    <td>lisi</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</td>
                                    <td><span class="platform-badge platform-2">ç¬¬äºŒå¹³å°</span><span class="platform-badge platform-3">ç¬¬ä¸‰å¹³å°</span></td>
                                    <td><span class="role-badge role-platform-admin">å¹³å°ç®¡ç†å‘˜</span></td>
                                    <td>2025-04-24 08:28</td>
                                    <td>2025-04-25 08:31</td>
<!--                                    <td>68æ¬¡</td>-->
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn remove-btn">æ”¶å›æƒé™</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>ç‹äº”</td>
                                    <td>wangwu</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºæ¾³é–€-æ€»éƒ¨éƒ¨é—¨-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</td>
                                    <td><span class="platform-badge platform-3">ç¬¬ä¸‰å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2025-04-23 08:28</td>
                                    <td>2025-04-24 18:20</td>
<!--                                    <td>126æ¬¡</td>-->
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn remove-btn">æ”¶å›æƒé™</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>èµµå…­</td>
                                    <td>zhaoliu</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-äººåŠ›èµ„æºéƒ¨éƒ¨éƒ¨</td>
                                    <td><span class="platform-badge platform-4">ç¬¬å››å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2025-04-22 08:28</td>
                                    <td>2025-04-25 12:11</td>
<!--                                    <td>18æ¬¡</td>-->
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn remove-btn">æ”¶å›æƒé™</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>é’±ä¸ƒ</td>
                                    <td>qianqi</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨</td>
                                    <td><span class="platform-badge platform-5">ç¬¬äº”å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2025-04-21 08:28</td>
                                    <td>2025-04-24 11:30</td>
<!--                                    <td>24æ¬¡</td>-->
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn remove-btn">æ”¶å›æƒé™</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- åˆ†é¡µ -->
                    <div class="pagination">
                        <button>&lt;</button>
                        <button class="active">1</button>
                        <button>2</button>
                        <button>3</button>
                        <button>&gt;</button>
                    </div>
                </div>
            </div>

            <!-- å½“å‰ç™»å½•ç”¨æˆ·å†…å®¹å¡ç‰‡ -->
            <div id="active-tab" class="card tab-content" style="display: none;">
                <div class="card-header">
                    <h3 class="card-title">å½“å‰ç™»å½•ç”¨æˆ·</h3>
                </div>
                <div class="card-body">
                    <!-- ç­›é€‰åŒºåŸŸ -->
                    <div class="filter-area">
                        <div class="filter-item">
                            <label>å§“å:</label>
                            <input type="text" placeholder="è¯·è¾“å…¥å§“å">
                        </div>
                        <div class="filter-item">
                            <label>åŸŸè´¦å·:</label>
                            <input type="text" placeholder="è¯·è¾“å…¥åŸŸè´¦å·">
                        </div>
                        <div class="filter-item">
                            <label>éƒ¨é—¨:</label>
                            <select>
                                <option value="">å…¨éƒ¨</option>
                                <option value="info">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</option>
                                <option value="house">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æˆ¿å±‹å…¬å¸-æˆ¿å±‹å…¬å¸åœ˜éšŠï¼ˆé§æ·±ï¼‰</option>
                                <option value="haihong">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨</option>
                                <option value="hr">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-äººåŠ›èµ„æºéƒ¨éƒ¨éƒ¨éƒ¨</option>
                                <option value="finance">ä¸­åœ‹å»ºç¯‰åœ‹éš›-é‡‘èæ¥­å‹™éƒ¨</option>
                                <option value="macau">ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºæ¾³é–€-æ€»éƒ¨éƒ¨é—¨-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>å¹³å°:</label>
                            <div class="multi-select" id="platform-filter">
                                <div class="multi-select-header">
                                    <span>å…¨éƒ¨</span>
                                    <span class="arrow">â–¼</span>
                                </div>
                                <div class="multi-select-dropdown">
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="ä¸€" checked> ç¬¬ä¸€å¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="äºŒ" checked> ç¬¬äºŒå¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="ä¸‰" checked> ç¬¬ä¸‰å¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="å››" checked> ç¬¬å››å¹³å°
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="äº”" checked> ç¬¬äº”å¹³å°
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-item">
                            <label>è§’è‰²:</label>
                            <div class="multi-select" id="role-filter">
                                <div class="multi-select-header">
                                    <span>å…¨éƒ¨</span>
                                    <span class="arrow">â–¼</span>
                                </div>
                                <div class="multi-select-dropdown">
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="user" checked> æ™®é€šç”¨æˆ·
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="platform-admin" checked> å¹³å°ç®¡ç†å‘˜
                                    </div>
                                    <div class="multi-select-option">
                                        <input type="checkbox" value="admin" checked> è¶…çº§ç®¡ç†å‘˜
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-item">
                            <label>ç™»å½•æ—¶é—´:</label>
                            <input type="date" class="date-picker">
                            <span class="date-separator">è‡³</span>
                            <input type="date" class="date-picker">
                        </div>
                        <div class="filter-item">
                            <button class="search-btn">æœç´¢</button>
                            <button class="reset-btn">é‡ç½®</button>
                        </div>
                    </div>

                    <!-- æ·»åŠ æ‰¹é‡æ“ä½œåŒºåŸŸ -->
                    <div class="batch-actions">
                        <button class="action-btn force-logout-btn">æ‰¹é‡å¼ºåˆ¶é€€å‡º</button>
                    </div>

                    <!-- è¡¨æ ¼å†…å®¹ -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th><input type="checkbox"></th>
                                    <th>å§“å</th>
                                    <th>åŸŸè´¦å·</th>
                                    <th>éƒ¨é—¨</th>
                                    <th>å¹³å°</th>
                                    <th>è§’è‰²</th>
                                    <th>ç™»å½•æ—¶é—´</th>
                                    <th>IPåœ°å€</th>
                                    <th>ç™»å½•è®¾å¤‡</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>å¼ ä¸‰</td>
                                    <td>zhangsan</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨</td>
                                    <td><span class="platform-badge platform-1">ç¬¬ä¸€å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2024-10-15 14:30</td>
                                    <td>192.168.1.101</td>
                                    <td>Chrome Windows</td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn force-logout-btn">å¼ºåˆ¶é€€å‡º</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>æå››</td>
                                    <td>lisi</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</td>
                                    <td><span class="platform-badge platform-2">ç¬¬äºŒå¹³å°</span></td>
                                    <td><span class="role-badge role-platform-admin">å¹³å°ç®¡ç†å‘˜</span></td>
                                    <td>2024-10-15 09:15</td>
                                    <td>192.168.1.102</td>
                                    <td>Safari MacOS</td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn force-logout-btn">å¼ºåˆ¶é€€å‡º</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>ç‹äº”</td>
                                    <td>wangwu</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨</td>
                                    <td><span class="platform-badge platform-3">ç¬¬ä¸‰å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2024-10-15 10:45</td>
                                    <td>192.168.1.103</td>
                                    <td>Edge Windows</td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn force-logout-btn">å¼ºåˆ¶é€€å‡º</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>èµµå…­</td>
                                    <td>zhaoliu</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-äººåŠ›èµ„æºéƒ¨éƒ¨éƒ¨</td>
                                    <td><span class="platform-badge platform-4">ç¬¬å››å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2024-10-15 11:30</td>
                                    <td>192.168.1.104</td>
                                    <td>Firefox Linux</td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn force-logout-btn">å¼ºåˆ¶é€€å‡º</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>é’±ä¸ƒ</td>
                                    <td>qianqi</td>
                                    <td>ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨</td>
                                    <td><span class="platform-badge platform-5">ç¬¬äº”å¹³å°</span></td>
                                    <td><span class="role-badge role-user">æ™®é€šç”¨æˆ·</span></td>
                                    <td>2024-10-15 08:30</td>
                                    <td>192.168.1.105</td>
                                    <td>Chrome Android</td>
                                    <td>
                                        <button class="action-btn view-btn">æŸ¥çœ‹</button>
                                        <button class="action-btn force-logout-btn">å¼ºåˆ¶é€€å‡º</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡† -->
            <div id="user-detail-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ç”¨æˆ·è¯¦æƒ…</h3>
                        <button class="close-btn" onclick="closeModal('user-detail-modal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="user-info-section">
                            <h4>åŸºæœ¬ä¿¡æ¯</h4>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">å§“åï¼š</div>
                                    <div class="info-value name-value">å¼ ä¸‰</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">åŸŸè´¦å·ï¼š</div>
                                    <div class="info-value email-value">zhangsan</div>
                                    <!-- åŸæ¥å¯èƒ½æ˜¯:
                                    <div class="info-label">å·¥å·ï¼š</div>
                                    <div class="info-value employeeId-value">ZH001</div>
                                    -->
                                </div>
                                <!-- å…¶ä»–ä¿¡æ¯é¡¹... -->
                            </div>
                        </div>
                        <!-- å…¶ä»–è¯¦æƒ…éƒ¨åˆ†... -->
                    </div>
                </div>
            </div>

            <!-- å®¡æ‰¹æ“ä½œå¼¹çª— -->
            <div id="approval-action-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>å®¡æ‰¹æ“ä½œ</h3>
                        <span class="close-btn">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="approval-form">
                            <div class="form-group">
                                <label for="approval-comment">å®¡æ‰¹æ„è§</label>
                                <textarea id="approval-comment" rows="3" placeholder="è¯·è¾“å…¥æ‚¨çš„å®¡æ‰¹æ„è§..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-btn submit-btn">æäº¤</button>
                        <button class="modal-btn cancel-btn">å…³é—­</button>
                    </div>
                </div>
            </div>

            <!-- ä¿®æ”¹æ·»åŠ ç”¨æˆ·æƒé™å¼¹çª—ï¼Œæ”¹ä¸ºå…ˆæ ¹æ®åŸŸè´¦å·æŸ¥æ‰¾ç”¨æˆ·ï¼Œå†ç¡®è®¤æ·»åŠ  -->
            <div class="modal" id="add-user-modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>æ·»åŠ ç”¨æˆ·æƒé™</h3>
                        <button class="close-btn" onclick="closeAddUserModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="addUserForm">
                            <!-- ç¬¬ä¸€æ­¥ï¼šåŸŸè´¦å·æœç´¢è¡¨å• -->
                            <div id="step-search" style="display: block;">
                                <div class="form-group">
                                    <label class="form-label required">ç”¨æˆ·åŸŸè´¦å·</label>
                                    <div class="email-search-container">
                                        <input type="text" class="form-input" id="search-email" placeholder="è¯·è¾“å…¥ä¼ä¸šåŸŸè´¦å·è¿›è¡ŒæŸ¥æ‰¾" required>
                                        <!-- <button type="button" class="search-user-btn" onclick="searchUserByEmail()">æŸ¥æ‰¾ç”¨æˆ·</button> -->
                                    </div>
                                    <span class="field-hint">è¯·è¾“å…¥ç”¨æˆ·çš„å®Œæ•´ä¼ä¸šåŸŸè´¦å·ï¼Œå°†ä»ä¼ä¸šIMç³»ç»Ÿä¸­æŸ¥æ‰¾å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯</span>
                                </div>
                                <div id="email-search-message" class="search-message" style="display: none;"></div>
                            </div>

                            <!-- ç¬¬äºŒæ­¥ï¼šç”¨æˆ·ä¿¡æ¯ç¡®è®¤å’Œæˆæƒè®¾ç½® -->
                            <div id="step-confirm" style="display: none;">
                                <div class="form-group">
                                    <div class="section-header">
                                        <label class="form-label">æŸ¥æ‰¾åˆ°çš„ç”¨æˆ·ä¿¡æ¯</label>
                                        <button type="button" class="back-btn" onclick="backToSearch()">è¿”å›é‡æ–°æŸ¥æ‰¾</button>
                                    </div>
                                    <div class="user-info-card">
                                        <div class="user-avatar">
                                            <div class="avatar-placeholder">
                                                <span id="user-initials">--</span>
                                            </div>
                                        </div>
                                        <div class="user-details">
                                            <div class="detail-row">
                                                <span class="detail-label">å§“å:</span>
                                                <span class="detail-value" id="user-name">--</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">éƒ¨é—¨:</span>
                                                <span class="detail-value" id="user-department">--</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">å²—ä½:</span>
                                                <span class="detail-value" id="user-position">--</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">åŸŸè´¦å·:</span>
                                                <span class="detail-value" id="user-email">--</span>
                                            </div>
                                            <!-- æ·»åŠ æ‰€å±å¹³å° -->
                                            <div class="detail-row">
                                                <span class="detail-label">æ‰€å±å¹³å°:</span>
                                                <span class="detail-value" id="user-platform">
                                                    <span class="platform-badge platform-1">ç¬¬ä¸€å¹³å°</span>
                                                </span>
                                                <input type="hidden" name="platform" id="platform-input" value="1">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="confirm-message">
                                        <p>è¯·ç¡®è®¤ä»¥ä¸Šç”¨æˆ·ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Œå¦‚ä¸æ­£ç¡®è¯·è¿”å›é‡æ–°æŸ¥æ‰¾</p>
                                    </div>
                                </div>
                                
                                <div class="form-group role-selection-group" id="roleSelectionGroup">
                                    <label class="form-label required">ç”¨æˆ·è§’è‰²</label>
                                    <div class="role-options">
                                        <div class="role-option">
                                            <label class="role-option-label">
                                                <input type="radio" name="role" value="user" checked>
                                                <div>
                                                    <div class="role-option-title">æ™®é€šç”¨æˆ·</div>
                                                    <div class="role-option-desc">å¯ä»¥ä½¿ç”¨å¹³å°çš„åŸºæœ¬åŠŸèƒ½ï¼Œæ— ç®¡ç†æƒé™</div>
                                                </div>
                                            </label>
                                        </div>
                                        <div class="role-option" id="platformAdminOption">
                                            <label class="role-option-label">
                                                <input type="radio" name="role" value="platform-admin">
                                                <div>
                                                    <div class="role-option-title">å¹³å°ç®¡ç†å‘˜</div>
                                                    <div class="role-option-desc">å¯ä»¥ç®¡ç†æ‰€åœ¨å¹³å°çš„ç”¨æˆ·å’Œå®¡æ‰¹æƒé™ç”³è¯·</div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <span class="field-hint">é€‰æ‹©é€‚åˆçš„ç”¨æˆ·è§’è‰²ï¼Œä¸åŒè§’è‰²å…·æœ‰ä¸åŒçš„æƒé™</span>
                                    <span class="field-hint">åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°è¿™é¡¹ï¼Œå¹³å°ç®¡ç†å‘˜åªèƒ½å¼€é€šæ™®é€šç”¨æˆ·æƒé™</span>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label required">ç®¡ç†å¹³å°</label>
                                    <div class="multi-select" id="manage-platform-select">
                                        <div class="multi-select-header">
                                            <span>é€‰æ‹©ç®¡ç†å¹³å°</span>
                                            <span class="arrow">â–¼</span>
                                        </div>
                                        <div class="multi-select-dropdown">
                                            <div class="multi-select-option">
                                                <input type="checkbox" value="1" checked> ç¬¬ä¸€å¹³å°
                                            </div>
                                            <div class="multi-select-option">
                                                <input type="checkbox" value="2"> ç¬¬äºŒå¹³å°
                                            </div>
                                            <div class="multi-select-option">
                                                <input type="checkbox" value="3"> ç¬¬ä¸‰å¹³å°
                                            </div>
                                            <div class="multi-select-option">
                                                <input type="checkbox" value="4"> ç¬¬å››å¹³å°
                                            </div>
                                            <div class="multi-select-option">
                                                <input type="checkbox" value="5"> ç¬¬äº”å¹³å°
                                            </div>
                                        </div>
                                    </div>
                                    <span class="field-hint">é€‰æ‹©ç”¨æˆ·å¯ä»¥ç®¡ç†çš„å¹³å°ï¼Œä»…åœ¨è§’è‰²ä¸º"å¹³å°ç®¡ç†å‘˜"æ—¶æœ‰æ•ˆ</span>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label required">æˆæƒå¤‡æ³¨</label>
                                    <textarea class="form-input" name="reason" placeholder="è¯·è¯¦ç»†è¯´æ˜æˆæƒåŸå› ã€ä¸šåŠ¡éœ€æ±‚æˆ–ç”¨é€”..." required></textarea>
                                    <span class="field-hint">è¯¦ç»†çš„è¯´æ˜æœ‰åŠ©äºè®°å½•å’Œè¿½è¸ªæƒé™æˆäºˆçš„åŸå› ï¼Œä¹Ÿä¾¿äºä»¥åçš„æƒé™å®¡è®¡</span>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-default" onclick="closeAddUserModal()">å–æ¶ˆ</button>
                                <button type="button" id="step-search-btn" class="btn btn-primary" style="display: none;" onclick="searchUserByEmail()">æŸ¥æ‰¾ç”¨æˆ·</button>
                                <button type="button" id="step-confirm-btn" class="btn btn-primary" style="display: none;" onclick="addUser()">ç¡®è®¤æ·»åŠ </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºé»˜è®¤æ ‡ç­¾é¡µ
        document.addEventListener('DOMContentLoaded', function() {
            // ä¿®æ”¹é»˜è®¤æ˜¾ç¤ºä¸ºæƒé™å®¡æ‰¹æ ‡ç­¾é¡µ
            showTab('approval');
            
            // ç¡®ä¿æ¨¡æ€æ¡†åˆå§‹éšè—
            const modal = document.getElementById('user-detail-modal');
            if (modal) {
                modal.style.display = 'none';
            }
            
            // ä½¿ç”¨æ­£ç¡®çš„é€‰æ‹©å™¨ç»‘å®šæŸ¥çœ‹æŒ‰é’®äº‹ä»¶
            const viewButtons = document.querySelectorAll('.view-btn');
            viewButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // è·å–å½“å‰è¡Œçš„æ•°æ®
                    const row = this.closest('tr');
                    
                    // ç¡®å®šå½“å‰æ˜¯å“ªä¸ªæ ‡ç­¾é¡µ
                    const tabId = row.closest('.tab-content').id;
                    
                    // æ ¹æ®æ ‡ç­¾é¡µè°ƒç”¨ä¸åŒçš„è¯¦æƒ…å±•ç¤ºå‡½æ•°
                    if (tabId === 'approval-tab') {
                        showApprovalDetails(row);
                    } else if (tabId === 'authorized-tab') {
                        showAuthorizedUserDetails(row);
                    } else if (tabId === 'active-tab') {
                        showActiveUserDetails(row);
                    }
                });
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('user-detail-modal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // ä¸ºæ¯ä¸ªåˆ†é¡µç»„ä»¶æ·»åŠ é¡µç é€‰æ‹©å™¨
            updatePaginationComponents();
        });

        function showTab(tabName) {
            // éšè—æ‰€æœ‰tabå†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„tabå†…å®¹
            document.getElementById(tabName + '-tab').style.display = 'block';
            
            // æ›´æ–°tabçŠ¶æ€
            document.querySelectorAll('.tab-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // æ‰¾åˆ°å¯¹åº”çš„tabé¡¹å¹¶æ·»åŠ activeç±»
            const tabs = document.querySelectorAll('.tab-item');
            switch(tabName) {
                case 'approval':
                    tabs[0].classList.add('active');
                    break;
                case 'authorized':
                    tabs[1].classList.add('active');
                    break;
                case 'active':
                    tabs[2].classList.add('active');
                    break;
            }
        }
        
        // ä¸ºæ ‡ç­¾é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
        document.querySelectorAll('.tab-item').forEach((tab, index) => {
            tab.addEventListener('click', function() {
                const tabNames = ['approval', 'authorized', 'active'];
                showTab(tabNames[index]);
            });
        });

        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            if (menu.style.display === 'block') {
                menu.style.display = 'none';
            } else {
                menu.style.display = 'block';
            }
        }

        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­èœå•
        document.addEventListener('click', function(event) {
            const userInfo = document.querySelector('.user-info');
            const userMenu = document.getElementById('userMenu');
            
            if (!userInfo.contains(event.target) && userMenu.style.display === 'block') {
                userMenu.style.display = 'none';
            }
        }, true);

        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                window.location.href = 'login.html';
            }
        }

        // å®Œå–„å®¡æ‰¹é€šè¿‡æ“ä½œå‡½æ•°
        function approveApproval(row, comment) {
            if (!row) return;
            
            // 1. æ›´æ–°çŠ¶æ€åˆ—
            const statusCell = row.querySelector('td:nth-child(9)');
            if (statusCell) {
                statusCell.innerHTML = '<span class="status status-approved">å·²é€šè¿‡</span>';
            }
            
            // 2. ç§»é™¤æ‹’ç»æŒ‰é’®ï¼Œå¹¶ç¦ç”¨å¤é€‰æ¡†
            const actionsCell = row.querySelector('td:nth-child(10)');
            if (actionsCell) {
                // ä¿ç•™æŸ¥çœ‹æŒ‰é’®ï¼Œç§»é™¤å…¶ä»–æŒ‰é’®
                const viewBtn = actionsCell.querySelector('.view-btn');
                actionsCell.innerHTML = '';
                if (viewBtn) {
                    const newViewBtn = viewBtn.cloneNode(true);
                    actionsCell.appendChild(newViewBtn);
                }
            }
            
            // 3. ç¦ç”¨å¤é€‰æ¡†
            const checkbox = row.querySelector('td:first-child input[type="checkbox"]');
            if (checkbox) {
                checkbox.disabled = true;
                checkbox.checked = false;
                checkbox.parentElement.title = 'å·²å¤„ç†çš„å®¡æ‰¹å•ä¸å¯é€‰æ‹©';
            }
            
            // 4. è®°å½•å®¡æ‰¹æ„è§ï¼ˆå®é™…åº”è¯¥å‘é€åˆ°åç«¯ï¼‰
            console.log('å®¡æ‰¹é€šè¿‡ï¼Œæ„è§ï¼š', comment || 'æ— ');
            
            // 5. å­˜å‚¨å®¡æ‰¹å¤‡æ³¨åˆ°è¡Œä¸Šçš„è‡ªå®šä¹‰å±æ€§ï¼Œä»¥ä¾¿æŸ¥çœ‹è¯¦æƒ…æ—¶æ˜¾ç¤º
            row.setAttribute('data-approval-comment', comment || '');
            
            // 6. æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€å’Œæ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
            updateApprovalHeaderCheckboxState();
            updateBatchActionStatus('approval');
            
            // 7. é‡æ–°ç»‘å®šæŸ¥çœ‹æŒ‰é’®äº‹ä»¶
            setupViewButtonEvents();
        }

        // å®Œå–„å®¡æ‰¹æ‹’ç»æ“ä½œå‡½æ•°
        function rejectApproval(row, comment) {
            if (!row) return;
            
            // 1. æ›´æ–°çŠ¶æ€åˆ—
            const statusCell = row.querySelector('td:nth-child(9)');
            if (statusCell) {
                statusCell.innerHTML = '<span class="status status-rejected">å·²æ‹’ç»</span>';
            }
            
            // 2. ç§»é™¤é€šè¿‡/æ‹’ç»æŒ‰é’®
            const actionsCell = row.querySelector('td:nth-child(10)');
            if (actionsCell) {
                // ä¿ç•™æŸ¥çœ‹æŒ‰é’®ï¼Œç§»é™¤å…¶ä»–æŒ‰é’®
                const viewBtn = actionsCell.querySelector('.view-btn');
                actionsCell.innerHTML = '';
                if (viewBtn) {
                    const newViewBtn = viewBtn.cloneNode(true);
                    actionsCell.appendChild(newViewBtn);
                }
            }
            
            // 3. ç¦ç”¨å¤é€‰æ¡†
            const checkbox = row.querySelector('td:first-child input[type="checkbox"]');
            if (checkbox) {
                checkbox.disabled = true;
                checkbox.checked = false;
                checkbox.parentElement.title = 'å·²å¤„ç†çš„å®¡æ‰¹å•ä¸å¯é€‰æ‹©';
            }
            
            // 4. è®°å½•å®¡æ‰¹æ„è§ï¼ˆå®é™…åº”è¯¥å‘é€åˆ°åç«¯ï¼‰
            console.log('å®¡æ‰¹æ‹’ç»ï¼Œç†ç”±ï¼š', comment || 'æ— ');
            
            // 5. å­˜å‚¨æ‹’ç»ç†ç”±åˆ°è¡Œä¸Šçš„è‡ªå®šä¹‰å±æ€§ï¼Œä»¥ä¾¿æŸ¥çœ‹è¯¦æƒ…æ—¶æ˜¾ç¤º
            row.setAttribute('data-rejection-reason', comment || '');
            
            // 6. æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€å’Œæ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
            updateApprovalHeaderCheckboxState();
            updateBatchActionStatus('approval');
            
            // 7. é‡æ–°ç»‘å®šæŸ¥çœ‹æŒ‰é’®äº‹ä»¶
            setupViewButtonEvents();
        }

        // æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€
        function updateApprovalHeaderCheckboxState() {
            const availableCheckboxes = document.querySelectorAll('#approval-tab table tbody td:first-child input[type="checkbox"]:not([disabled])');
            const checkedCheckboxes = document.querySelectorAll('#approval-tab table tbody td:first-child input[type="checkbox"]:checked:not([disabled])');
            const headerCheckbox = document.querySelector('#approval-tab table thead th:first-child input[type="checkbox"]');
            
            if (headerCheckbox && availableCheckboxes.length > 0) {
                const allChecked = Array.from(availableCheckboxes).every(cb => cb.checked);
                const anyChecked = Array.from(availableCheckboxes).some(cb => cb.checked);
                
                headerCheckbox.checked = allChecked;
                headerCheckbox.indeterminate = anyChecked && !allChecked;
            } else if (headerCheckbox) {
                // å¦‚æœæ²¡æœ‰å¯ç”¨çš„å¤é€‰æ¡†ï¼Œåˆ™å–æ¶ˆé€‰ä¸­è¡¨å¤´å¤é€‰æ¡†
                headerCheckbox.checked = false;
                headerCheckbox.indeterminate = false;
            }
            
            // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
            updateBatchActionStatus('approval', checkedCheckboxes.length);
        }

        // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
        function updateBatchActionStatus(tabName, checkedCount) {
            // è·å–æ‰¹é‡æ“ä½œæŒ‰é’®
            const batchApproveBtn = document.querySelector(`#${tabName}-tab .batch-actions .approve-btn`);
            const batchRejectBtn = document.querySelector(`#${tabName}-tab .batch-actions .reject-btn`);
            
            if (batchApproveBtn && batchRejectBtn) {
                if (checkedCount > 0) {
                    // æœ‰é€‰ä¸­é¡¹ï¼Œå¯ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºæ•°é‡
                    batchApproveBtn.classList.remove('disabled');
                    batchRejectBtn.classList.remove('disabled');
                    
                    // æ›´æ–°æŒ‰é’®æ–‡æœ¬ï¼Œæ˜¾ç¤ºé€‰ä¸­æ•°é‡
                    batchApproveBtn.textContent = `æ‰¹é‡é€šè¿‡ (${checkedCount})`;
                    batchRejectBtn.textContent = `æ‰¹é‡æ‹’ç» (${checkedCount})`;
                } else {
                    // æ— é€‰ä¸­é¡¹ï¼Œç¦ç”¨æŒ‰é’®
                    batchApproveBtn.classList.add('disabled');
                    batchRejectBtn.classList.add('disabled');
                    
                    // æ¢å¤é»˜è®¤æ–‡æœ¬
                    batchApproveBtn.textContent = 'æ‰¹é‡é€šè¿‡';
                    batchRejectBtn.textContent = 'æ‰¹é‡æ‹’ç»';
                }
            }
        }

        // æ‰¹é‡å®¡æ‰¹æ“ä½œ
        function batchApprovalAction(action) {
            // è·å–æ‰€æœ‰é€‰ä¸­çš„æœªå¤„ç†è¡Œ
            const checkedRows = document.querySelectorAll('#approval-tab table tbody td:first-child input[type="checkbox"]:checked:not([disabled])');
            
            if (checkedRows.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©å¾…å¤„ç†çš„ç”³è¯·');
                return;
            }
            
            // æ˜¾ç¤ºæ‰¹é‡å®¡æ‰¹æ¨¡æ€æ¡†
            const modal = document.getElementById('approval-action-modal');
            if (!modal) return;
            
            // è®¾ç½®æ¨¡æ€æ¡†æ ‡é¢˜ï¼Œæ·»åŠ é€‰ä¸­æ•°é‡æ˜¾ç¤º
            modal.querySelector('.modal-header h3').innerHTML = formatBatchTitle(action, checkedRows.length);
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.style.display = 'flex';
            
            // èšç„¦åˆ°æ–‡æœ¬æ¡†
            setTimeout(() => {
                document.getElementById('approval-comment').focus();
            }, 100);
            
            // ä¿å­˜å½“å‰æ‰¹é‡æ“ä½œç±»å‹å’Œé€‰ä¸­çš„è¡Œ
            modal.dataset.action = action;
            modal.dataset.rows = Array.from(checkedRows).map(cb => {
                return Array.from(cb.closest('tr').parentNode.children).indexOf(cb.closest('tr'));
            }).join(',');
            
            // å°†æäº¤æŒ‰é’®çš„äº‹ä»¶å¤„ç†ç¨‹åºæ”¹ä¸ºæ‰¹é‡å¤„ç†
            const submitBtn = modal.querySelector('.submit-btn');
            if (submitBtn) {
                // ç§»é™¤ç°æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
                const newSubmitBtn = submitBtn.cloneNode(true);
                submitBtn.parentNode.replaceChild(newSubmitBtn, submitBtn);
                
                // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
                newSubmitBtn.addEventListener('click', function() {
                    // è·å–æ‰¹é‡å®¡æ‰¹æ„è§
                    const comment = document.getElementById('approval-comment').value.trim();
                    
                    // è·å–é€‰ä¸­çš„è¡Œç´¢å¼•
                    const rowIndices = modal.dataset.rows.split(',').map(Number);
                    const tbody = document.querySelector('#approval-tab table tbody');
                    const rows = tbody.querySelectorAll('tr');
                    
                    // æ‰§è¡Œæ‰¹é‡æ“ä½œ
                    rowIndices.forEach(index => {
                        if (index >= 0 && index < rows.length) {
                            const row = rows[index];
                            if (modal.dataset.action === 'approve') {
                                approveApproval(row, comment);
                            } else {
                                rejectApproval(row, comment);
                            }
                        }
                    });
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    modal.style.display = 'none';
                    
                    // æ¸…ç©ºæ–‡æœ¬æ¡†
                    document.getElementById('approval-comment').value = '';
                    
                    // æ˜¾ç¤ºæ“ä½œæˆåŠŸæ¶ˆæ¯
                    alert(`å·²${modal.dataset.action === 'approve' ? 'æ‰¹é‡é€šè¿‡' : 'æ‰¹é‡æ‹’ç»'} ${rowIndices.length} æ¡ç”³è¯·`);
                });
            }
        }

        // ä¸ºå®¡æ‰¹æ“ä½œå¼¹çª—æ·»åŠ äº‹ä»¶å¤„ç†
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–å•ä¸ªå®¡æ‰¹æŒ‰é’®
            const approveButtons = document.querySelectorAll('#approval-tab .approve-btn:not(.batch-actions .approve-btn)');
            const rejectButtons = document.querySelectorAll('#approval-tab .reject-btn:not(.batch-actions .reject-btn)');
            
            // ä¸ºå•ä¸ªå®¡æ‰¹æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            approveButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // è·å–å½“å‰è¡Œ
                    const row = this.closest('tr');
                    
                    // è·å–å®¡æ‰¹æ¨¡æ€æ¡†
                    const modal = document.getElementById('approval-action-modal');
                    if (!modal) return;
                    
                    // è®¾ç½®æ¨¡æ€æ¡†æ ‡é¢˜
                    modal.querySelector('.modal-header h3').textContent = 'å®¡æ‰¹é€šè¿‡';
                    
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    modal.style.display = 'flex';
                    
                    // èšç„¦åˆ°æ–‡æœ¬æ¡†
                    setTimeout(() => {
                        document.getElementById('approval-comment').focus();
                    }, 100);
                    
                    // è·å–æäº¤æŒ‰é’®
                    const submitBtn = modal.querySelector('.submit-btn');
                    if (submitBtn) {
                        // ç§»é™¤ç°æœ‰çš„äº‹ä»¶ç›‘å¬å™¨
                        const newSubmitBtn = submitBtn.cloneNode(true);
                        submitBtn.parentNode.replaceChild(newSubmitBtn, submitBtn);
                        
                        // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
                        newSubmitBtn.addEventListener('click', function() {
                            // è·å–å®¡æ‰¹æ„è§
                            const comment = document.getElementById('approval-comment').value.trim();
                            
                            // æ‰§è¡Œå®¡æ‰¹é€šè¿‡æ“ä½œ
                            approveApproval(row, comment);
                            
                            // å…³é—­æ¨¡æ€æ¡†
                            modal.style.display = 'none';
                            
                            // æ¸…ç©ºæ–‡æœ¬æ¡†
                            document.getElementById('approval-comment').value = '';
                        });
                    }
                });
            });
            
            rejectButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // è·å–å½“å‰è¡Œ
                    const row = this.closest('tr');
                    
                    // è·å–å®¡æ‰¹æ¨¡æ€æ¡†
                    const modal = document.getElementById('approval-action-modal');
                    if (!modal) return;
                    
                    // è®¾ç½®æ¨¡æ€æ¡†æ ‡é¢˜
                    modal.querySelector('.modal-header h3').textContent = 'å®¡æ‰¹æ‹’ç»';
                    
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    modal.style.display = 'flex';
                    
                    // èšç„¦åˆ°æ–‡æœ¬æ¡†
                    setTimeout(() => {
                        document.getElementById('approval-comment').focus();
                    }, 100);
                    
                    // è·å–æäº¤æŒ‰é’®
                    const submitBtn = modal.querySelector('.submit-btn');
                    if (submitBtn) {
                        // ç§»é™¤ç°æœ‰çš„äº‹ä»¶ç›‘å¬å™¨
                        const newSubmitBtn = submitBtn.cloneNode(true);
                        submitBtn.parentNode.replaceChild(newSubmitBtn, submitBtn);
                        
                        // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
                        newSubmitBtn.addEventListener('click', function() {
                            // è·å–å®¡æ‰¹æ„è§
                            const comment = document.getElementById('approval-comment').value.trim();
                            
                            // æ‰§è¡Œå®¡æ‰¹æ‹’ç»æ“ä½œ
                            rejectApproval(row, comment);
                            
                            // å…³é—­æ¨¡æ€æ¡†
                            modal.style.display = 'none';
                            
                            // æ¸…ç©ºæ–‡æœ¬æ¡†
                            document.getElementById('approval-comment').value = '';
                        });
                    }
                });
            });
            
            // è·å–æ‰¹é‡æ“ä½œæŒ‰é’®
            const batchApproveBtn = document.querySelector('#approval-tab .batch-actions .approve-btn');
            const batchRejectBtn = document.querySelector('#approval-tab .batch-actions .reject-btn');
            
            // ä¸ºæ‰¹é‡å®¡æ‰¹æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            if (batchApproveBtn) {
                batchApproveBtn.addEventListener('click', function() {
                    batchApprovalAction('approve');
                });
            }
            
            if (batchRejectBtn) {
                batchRejectBtn.addEventListener('click', function() {
                    batchApprovalAction('reject');
                });
            }
            
            // ä¸ºå…³é—­æŒ‰é’®æ·»åŠ äº‹ä»¶
            const closeButtons = document.querySelectorAll('#approval-action-modal .close-btn, #approval-action-modal .cancel-btn');
            closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    document.getElementById('approval-action-modal').style.display = 'none';
                    document.getElementById('approval-comment').value = '';
                });
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('approval-action-modal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                    document.getElementById('approval-comment').value = '';
                }
            });
        });

        // ä¿®æ”¹ showAddUserModal å‡½æ•°ç¡®ä¿ç®¡ç†å¹³å°å¤šé€‰æ¡†åœ¨æ¨¡æ€æ¡†æ‰“å¼€æ—¶æ­£ç¡®åˆå§‹åŒ–
        function showAddUserModal() {
            const modal = document.getElementById('add-user-modal');
            
            // é‡ç½®è¡¨å•çŠ¶æ€
            document.getElementById('step-search').style.display = 'block';
            document.getElementById('step-confirm').style.display = 'none';
            document.getElementById('step-search-btn').style.display = 'block';
            document.getElementById('step-confirm-btn').style.display = 'none';
            
            // æ¸…ç©ºåŸŸè´¦å·æœç´¢æ¡†
            document.getElementById('search-email').value = '';
            
            // éšè—æœç´¢æ¶ˆæ¯
            const searchMessage = document.getElementById('email-search-message');
            searchMessage.style.display = 'none';
            searchMessage.className = 'search-message';
            searchMessage.textContent = '';
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.style.display = 'flex';
            
            // åˆå§‹åŒ–è§’è‰²é€‰æ‹©å’Œç®¡ç†å¹³å°ä¸‹æ‹‰æ¡†
            setTimeout(() => {
                // ç”¨setTimeoutç¡®ä¿DOMå·²ç»å®Œå…¨æ¸²æŸ“
                console.log('åˆå§‹åŒ–è§’è‰²é€‰æ‹©å’Œç®¡ç†å¹³å°ä¸‹æ‹‰æ¡†');
                initRoleSelection();
                
                // ç¡®ä¿ç®¡ç†å¹³å°è¡¨å•ç»„åˆå§‹çŠ¶æ€æ˜¯éšè—çš„ï¼ˆå› ä¸ºé»˜è®¤é€‰æ‹©æ™®é€šç”¨æˆ·ï¼‰
                const managePlatformGroup = document.querySelector('#manage-platform-select').closest('.form-group');
                if (managePlatformGroup) {
                    console.log('ç¡®ä¿ç®¡ç†å¹³å°è¡¨å•ç»„åˆå§‹éšè—');
                    managePlatformGroup.style.display = 'none';
                }
            }, 100);
        }

        // å…³é—­æ·»åŠ ç”¨æˆ·å¼¹çª—
        function closeAddUserModal() {
            const modal = document.getElementById('add-user-modal');
            modal.style.display = 'none';
            
            // é‡ç½®è¡¨å•
            document.getElementById('addUserForm').reset();
        }

        // æ ¹æ®åŸŸè´¦å·æŸ¥æ‰¾ç”¨æˆ·
        function searchUserByEmail() {
            const email = document.getElementById('search-email').value.trim();
            const searchMessage = document.getElementById('email-search-message');
            
            // éªŒè¯åŸŸè´¦å·æ ¼å¼
            // if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            //     searchMessage.className = 'search-message error';
            //     searchMessage.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„ä¼ä¸šåŸŸè´¦å·åœ°å€';
            //     searchMessage.style.display = 'block';
            //     return;
            // }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            searchMessage.className = 'search-message loading';
            searchMessage.textContent = 'æ­£åœ¨æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·ç¨å€™...';
            searchMessage.style.display = 'block';
            
            // æ¨¡æ‹ŸAPIè¯·æ±‚å»¶è¿Ÿ
            setTimeout(() => {
                // è¿™é‡Œæ˜¯æ¨¡æ‹Ÿçš„ç”¨æˆ·æ•°æ®ï¼Œå®é™…åº”è¯¥ä»APIè·å–
                const userData = mockSearchUserByEmail(email);
                
                if (userData) {
                    // ç”¨æˆ·æ‰¾åˆ°äº†ï¼Œå¡«å……ç”¨æˆ·ä¿¡æ¯
                    populateUserInfo(userData);
                    
                    // åˆ‡æ¢åˆ°ç¬¬äºŒæ­¥
                    document.getElementById('step-search').style.display = 'none';
                    document.getElementById('step-confirm').style.display = 'block';
                    document.getElementById('step-search-btn').style.display = 'none';
                    document.getElementById('step-confirm-btn').style.display = 'block';
                    
                    // éšè—æœç´¢æ¶ˆæ¯
                    searchMessage.style.display = 'none';
                    
                    // æ·»åŠ å»¶è¿Ÿç¡®ä¿DOMå·²æ›´æ–°
                    setTimeout(() => {
                        console.log('æœç´¢æˆåŠŸï¼Œåˆå§‹åŒ–è§’è‰²é€‰æ‹©');
                        
                        // ç¡®ä¿å¼€å§‹æ—¶é€‰æ‹©æ™®é€šç”¨æˆ·
                        document.querySelector('#add-user-modal input[name="role"][value="user"]').checked = true;
                        
                        // åˆå§‹åŒ–è§’è‰²é€‰æ‹©ï¼ˆè§¦å‘handleRoleChangeï¼‰
                        initRoleSelection();
                        
                        // ç¡®ä¿ç®¡ç†å¹³å°å¤šé€‰æ¡†éšè—
                        const managePlatformGroup = document.querySelector('#manage-platform-select').closest('.form-group');
                        if (managePlatformGroup) {
                            managePlatformGroup.style.display = 'none';
                            console.log('ç¡®ä¿ç®¡ç†å¹³å°è¡¨å•ç»„åˆå§‹éšè—');
                        }
                        
                        // ä¸ºè§’è‰²é€‰é¡¹æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                        document.querySelectorAll('#add-user-modal input[name="role"]').forEach(radio => {
                            radio.addEventListener('change', function() {
                                console.log('è§’è‰²é€‰æ‹©å˜æ›´:', this.value);
                                handleRoleChange();
                            });
                        });
                    }, 100);
                } else {
                    // ç”¨æˆ·æœªæ‰¾åˆ°
                    searchMessage.className = 'search-message error';
                    searchMessage.textContent = 'æœªæ‰¾åˆ°æ­¤åŸŸè´¦å·å¯¹åº”çš„ç”¨æˆ·ï¼Œè¯·æ£€æŸ¥åŸŸè´¦å·åœ°å€æ˜¯å¦æ­£ç¡®';
                    searchMessage.innerHTML += '<br>æ ·ä¾‹: zhangsan, lisi';
                    searchMessage.style.display = 'block';
                }
            }, 1000); // æ¨¡æ‹Ÿ1ç§’å»¶è¿Ÿ
        }

        // æ¨¡æ‹Ÿæ ¹æ®åŸŸè´¦å·æœç´¢ç”¨æˆ·ï¼ˆå®é™…å®ç°ä¸­åº”è¯¥è°ƒç”¨åç«¯APIï¼‰
        function mockSearchUserByEmail(email) {
            // æ¨¡æ‹Ÿçš„ç”¨æˆ·æ•°æ®åº“
            const users = {
                'zhangsan': {
                    name: 'å¼ ä¸‰',
                    employeeId: 'zhangsan',
                    department: 'ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨',
                    position: 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ',
                    email: 'zhangsan',
                    platform: 'ä¸€'  // æ·»åŠ å¹³å°ä¿¡æ¯
                },
                'lisi': {
                    name: 'æå››',
                    employeeId: 'lisi',
                    department: 'ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æˆ¿å±‹å…¬å¸-æˆ¿å±‹å…¬å¸åœ˜éšŠï¼ˆé§æ·±ï¼‰',
                    position: 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ',
                    email: 'lisi',
                    platform: 'äºŒ'  // æ·»åŠ å¹³å°ä¿¡æ¯
                },
                'wangwu': {
                    name: 'ç‹äº”',
                    employeeId: 'wangwu',
                    department: 'ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨',
                    position: 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ',
                    email: 'wangwu',
                    platform: 'ä¸‰'  // æ·»åŠ å¹³å°ä¿¡æ¯
                },
                'zhaoliu': {
                    name: 'èµµå…­',
                    employeeId: 'zhaoliu',
                    department: 'ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-äººåŠ›èµ„æºéƒ¨éƒ¨éƒ¨éƒ¨',
                    position: 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ',
                    email: 'zhaoliu',
                    platform: 'å››'  // æ·»åŠ å¹³å°ä¿¡æ¯
                },
                'qianqi': {
                    name: 'é’±ä¸ƒ',
                    employeeId: 'qianqi',
                    department: 'ä¸­åœ‹å»ºç¯‰åœ‹éš›-é‡‘èæ¥­å‹™éƒ¨',
                    position: 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ',
                    email: 'qianqi',
                    platform: 'äºŒ'  // æ·»åŠ å¹³å°ä¿¡æ¯
                },
                'liuer': {
                    name: 'åˆ˜äºŒ',
                    employeeId: 'liuer',
                    department: 'ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºæ¾³é–€-æ€»éƒ¨éƒ¨é—¨-ä¿¡æ¯åŒ–ç®¡ç†éƒ¨',
                    position: 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ',
                    email: 'liuer',
                    platform: 'ä¸‰'  // æ·»åŠ å¹³å°ä¿¡æ¯
                }
            };
            
            // è¿”å›æ‰¾åˆ°çš„ç”¨æˆ·æˆ–null
            return users[email] || null;
        }

        // å¡«å……ç”¨æˆ·ä¿¡æ¯åˆ°ç¡®è®¤é¡µé¢
        function populateUserInfo(userData) {
            document.getElementById('user-name').textContent = userData.name;
            // document.getElementById('user-employeeId').textContent = userData.employeeId;
            document.getElementById('user-department').textContent = userData.department;
            document.getElementById('user-position').textContent = userData.position;
            document.getElementById('user-email').textContent = userData.email;
            
            // è®¾ç½®ç”¨æˆ·çš„å¹³å°ä¿¡æ¯
            const platformElement = document.getElementById('user-platform');
            const platformInput = document.getElementById('platform-input');
            const platformNumber = userData.platform || 'ä¸€'; // å¦‚æœæœªæŒ‡å®šå¹³å°ï¼Œé»˜è®¤ä¸ºç¬¬ä¸€å¹³å°
            
            platformElement.innerHTML = `<span class="platform-badge platform-${platformNumber}">ç¬¬${platformNumber}å¹³å°</span>`;
            platformInput.value = platformNumber;
            
            // è®¾ç½®å¤´åƒç¼©å†™
            if (userData.name) {
                const initials = userData.name.substring(0, 1);
                document.getElementById('user-initials').textContent = initials;
            }
        }

        // è¿”å›åˆ°æœç´¢æ­¥éª¤
        function backToSearch() {
            document.getElementById('step-search').style.display = 'block';
            document.getElementById('step-confirm').style.display = 'none';
            document.getElementById('step-search-btn').style.display = 'block';
            document.getElementById('step-confirm-btn').style.display = 'none';
        }

        // æ·»åŠ ç”¨æˆ·ï¼ˆç¡®è®¤æ­¥éª¤åï¼‰
        function addUser() {
            // è·å–ç”¨æˆ·ä¿¡æ¯
            const name = document.getElementById('user-name').textContent;
            const department = document.getElementById('user-department').textContent;
            const position = document.getElementById('user-position').textContent;
            const email = document.getElementById('user-email').textContent;
            
            // è·å–æˆæƒä¿¡æ¯
            const reason = document.querySelector('#add-user-modal textarea[name="reason"]').value.trim();
            
            // è·å–å¹³å°å’Œè§’è‰²
            const platform = document.getElementById('platform-input').value;
            const role = document.querySelector('#add-user-modal input[name="role"]:checked').value;
            
            // è·å–ç®¡ç†å¹³å°ï¼ˆåªåœ¨è§’è‰²ä¸ºå¹³å°ç®¡ç†å‘˜æ—¶æœ‰æ•ˆï¼‰
            const managePlatforms = [];
            if (role === 'platform-admin') {
                const platformCheckboxes = document.querySelectorAll('#manage-platform-select .multi-select-option input:checked');
                platformCheckboxes.forEach(checkbox => {
                    managePlatforms.push(checkbox.value);
                });
                
                // éªŒè¯è‡³å°‘é€‰æ‹©äº†ä¸€ä¸ªç®¡ç†å¹³å°
                if (managePlatforms.length === 0) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç®¡ç†å¹³å°');
                    return;
                }
            }
            
            // éªŒè¯æˆæƒç†ç”±
            if (!reason) {
                alert('è¯·å¡«å†™æˆæƒå¤‡æ³¨');
                return;
            }
            
            // æ„å»ºæ·»åŠ ç”¨æˆ·æ•°æ®
            const userData = {
                user: {
                    name: name,
                    department: department,
                    position: position,
                    email: email
                },
                reason: reason,
                platform: platform,
                role: role,
                managePlatforms: role === 'platform-admin' ? managePlatforms : [],
                addTime: new Date().toISOString()
            };
            
            console.log('æ·»åŠ ç”¨æˆ·æƒé™æ•°æ®:', userData);
            
            // æ¨¡æ‹Ÿæ·»åŠ æˆåŠŸ - æ·»åŠ åˆ°å·²æˆæƒç”¨æˆ·åˆ—è¡¨ä¸­
            const authorizedTable = document.querySelector('#authorized-tab table tbody');
            
            const now = new Date();
            const dateFormatted = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
            
            // åˆ›å»ºæ–°è¡Œ
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="checkbox"></td>
                <td>${name}</td>
                <td>${email}</td>
                <td>${department}</td>
                <td><span class="platform-badge platform-${platform}">ç¬¬${platform}å¹³å°</span></td>
                <td><span class="role-badge ${role === 'user' ? 'role-user' : role === 'platform-admin' ? 'role-platform-admin' : 'role-admin'}">${role === 'user' ? 'æ™®é€šç”¨æˆ·' : role === 'platform-admin' ? 'å¹³å°ç®¡ç†å‘˜' : 'è¶…çº§ç®¡ç†å‘˜'}</span></td>
                <td>${dateFormatted}</td>
                <td>${dateFormatted}</td>
                <td>0æ¬¡</td>
                <td>
                    <button class="action-btn view-btn">æŸ¥çœ‹</button>
                    <button class="action-btn remove-btn">æ”¶å›æƒé™</button>
                </td>
            `;
            
            // å°†æ–°è¡Œæ·»åŠ åˆ°è¡¨æ ¼é¡¶éƒ¨
            if (authorizedTable) {
                authorizedTable.insertBefore(newRow, authorizedTable.firstChild);
                
                // ç»‘å®šæ–°è¡Œä¸Šçš„æŒ‰é’®äº‹ä»¶
                const viewBtn = newRow.querySelector('.view-btn');
                const revokeBtn = newRow.querySelector('.remove-btn');
                
                if (viewBtn) {
                    viewBtn.addEventListener('click', function() {
                        // æ˜¾ç¤ºç”¨æˆ·è¯¦æƒ…ï¼ŒåŒ…æ‹¬ç®¡ç†å¹³å°ä¿¡æ¯
                        let detailInfo = reason;
                        
                        // å¦‚æœæ˜¯å¹³å°ç®¡ç†å‘˜ï¼Œæ·»åŠ ç®¡ç†å¹³å°ä¿¡æ¯
                        if (role === 'platform-admin' && managePlatforms.length > 0) {
                            const platformsText = managePlatforms.map(p => `ç¬¬${p}å¹³å°`).join('ã€');
                            detailInfo += `\n\nç®¡ç†å¹³å°ï¼š${platformsText}`;
                        }
                        
                        showUserDetail(name, email, department, dateFormatted, detailInfo, '0æ¬¡');
                    });
                }
                
                if (revokeBtn) {
                    revokeBtn.addEventListener('click', function() {
                        if (confirm(`ç¡®å®šè¦æ”¶å› ${name} çš„æƒé™å—ï¼Ÿ`)) {
                            // åˆ é™¤æ•´è¡Œï¼Œè€Œä¸åªæ˜¯æ›´æ”¹çŠ¶æ€
                            authorizedTable.removeChild(newRow);
                            // æ˜¾ç¤ºæ”¶å›æˆåŠŸçš„æ¶ˆæ¯
                            alert(`å·²æˆåŠŸæ”¶å› ${name} çš„æƒé™`);
                        }
                    });
                }
            }
            
            // å…³é—­å¼¹çª—
            alert('ç”¨æˆ·æƒé™æ·»åŠ æˆåŠŸ');
            closeAddUserModal();
        }

        // Function to check if current user is super admin
        function isSuperAdmin() {
            // In real implementation, this would check the current user's role from session/API
            // For demo purposes, we'll assume the current user is a super admin
            return true;
        }
        
        // Handle platform change
        function handlePlatformChange() {
            const platformSelect = document.querySelector('.platform-select');
            const platformAdminOption = document.getElementById('platformAdminOption');
            
            if (platformSelect && platformAdminOption) {
                // Only enable platform admin role for super admins on any platform
                // or platform admins on their own platform
                if (isSuperAdmin()) {
                    platformAdminOption.classList.remove('disabled');
                    platformAdminOption.querySelector('input').disabled = false;
                } else {
                    // For non-super admins, disable platform admin option
                    platformAdminOption.classList.add('disabled');
                    platformAdminOption.querySelector('input').disabled = true;
                    // Ensure "user" option is selected
                    document.querySelector('input[name="role"][value="user"]').checked = true;
                }
            }
        }
        
        // Initialize role selection when tab is switched or form is shown
        function initRoleSelection() {
            // é¦–å…ˆç¡®ä¿æˆ‘ä»¬å¤„ç†çš„æ˜¯åˆå§‹çŠ¶æ€
            document.querySelector('#add-user-modal input[name="role"][value="user"]').checked = true;
            
            // ç„¶ååº”ç”¨åˆå§‹çŠ¶æ€
            handleRoleChange();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ä»¥ä¾¿è§’è‰²é€‰æ‹©å˜åŒ–æ—¶æ›´æ–°æ˜¾ç¤º
            const roleOptions = document.querySelectorAll('#add-user-modal input[name="role"]');
            roleOptions.forEach(option => {
                // ç§»é™¤ç°æœ‰çš„ç›‘å¬å™¨ä»¥é¿å…é‡å¤
                option.removeEventListener('change', handleRoleChange);
                // æ·»åŠ æ–°çš„ç›‘å¬å™¨
                option.addEventListener('change', handleRoleChange);
            });
            
            // åˆå§‹åŒ–ç®¡ç†å¹³å°å¤šé€‰ä¸‹æ‹‰æ¡†
            initManagePlatformSelect();
            
            console.log('è§’è‰²é€‰æ‹©åˆå§‹åŒ–å®Œæˆ');
        }

        // Initialize all multi-select dropdowns
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize multi-select dropdowns
            initMultiSelectDropdowns();
        });

        function initMultiSelectDropdowns() {
            // Find all multi-select elements
            const multiSelects = document.querySelectorAll('.multi-select');
            
            multiSelects.forEach(select => {
                const header = select.querySelector('.multi-select-header');
                const dropdown = select.querySelector('.multi-select-dropdown');
                const options = select.querySelectorAll('.multi-select-option input');
                const headerText = header.querySelector('span');
                
                // Toggle dropdown on header click
                header.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    // Close all other open dropdowns
                    document.querySelectorAll('.multi-select-dropdown.active').forEach(d => {
                        if (d !== dropdown) {
                            d.classList.remove('active');
                            d.closest('.multi-select').querySelector('.multi-select-header').classList.remove('active');
                        }
                    });
                    
                    // Toggle current dropdown
                    dropdown.classList.toggle('active');
                    header.classList.toggle('active');
                });
                
                // Handle option selection
                options.forEach(option => {
                    option.addEventListener('change', (e) => {
                        e.stopPropagation();
                        updateHeaderText(select);
                    });
                    
                    // Prevent dropdown from closing when clicking on options
                    option.parentElement.addEventListener('click', (e) => {
                        e.stopPropagation();
                    });
                });
                
                // Initial header text
                updateHeaderText(select);
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', () => {
                document.querySelectorAll('.multi-select-dropdown.active').forEach(dropdown => {
                    dropdown.classList.remove('active');
                    dropdown.closest('.multi-select').querySelector('.multi-select-header').classList.remove('active');
                });
            });
        }

        // Update the header text based on selected options
        function updateHeaderText(select) {
            const header = select.querySelector('.multi-select-header span');
            const options = select.querySelectorAll('.multi-select-option input');
            const selectedOptions = Array.from(options).filter(opt => opt.checked);
            
            if (selectedOptions.length === 0) {
                header.textContent = 'è¯·é€‰æ‹©';
            } else if (selectedOptions.length === options.length) {
                header.textContent = 'å…¨éƒ¨';
            } else if (selectedOptions.length <= 2) {
                const labels = selectedOptions.map(opt => {
                    const text = opt.parentElement.textContent.trim();
                    return text;
                });
                header.textContent = labels.join(', ');
            } else {
                header.textContent = `å·²é€‰ ${selectedOptions.length} é¡¹`;
            }
        }

        // æ˜¾ç¤ºç”¨æˆ·è¯¦æƒ…
        function showUserDetail(name, employeeId, department, addTime, reason, usageCount) {
            // è·å–ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†
            const modal = document.getElementById('user-detail-modal');
            
            // æ›´æ–°æ¨¡æ€æ¡†æ ‡é¢˜å’Œå†…å®¹
            modal.querySelector('.modal-header h3').textContent = `ç”¨æˆ·è¯¦æƒ… - ${name}`;
            
            // å¡«å……ç”¨æˆ·ä¿¡æ¯
            const modalBody = modal.querySelector('.modal-body');
            modalBody.innerHTML = `
                <div class="detail-section">
                    <h4>ç”¨æˆ·ä¿¡æ¯</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">å§“å</div>
                            <div class="detail-value">${name}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">åŸŸè´¦å·</div>
                            <div class="detail-value">${employeeId}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">éƒ¨é—¨</div>
                            <div class="detail-value">${department}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æˆæƒæ—¶é—´</div>
                            <div class="detail-value">${addTime}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ä½¿ç”¨æ¬¡æ•°</div>
                            <div class="detail-value">${usageCount}</div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>æˆæƒå¤‡æ³¨</h4>
                    <div class="detail-remarks">
                        ${reason || 'æ— '}
                    </div>
                </div>
            `;
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.style.display = 'flex';
            
            // ç¡®ä¿å…³é—­æŒ‰é’®æœ‰äº‹ä»¶
            const closeBtn = modal.querySelector('.close-btn');
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    modal.style.display = 'none';
                });
            }
        }

        // åœ¨é¡µé¢åŠ è½½æ—¶ä¸ºå·²å­˜åœ¨çš„æ”¶å›æƒé™æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸ºå·²æˆæƒç”¨æˆ·è¡¨æ ¼ä¸­çš„æ‰€æœ‰æ”¶å›æƒé™æŒ‰é’®æ·»åŠ äº‹ä»¶
            const removeButtons = document.querySelectorAll('#authorized-tab .remove-btn');
            removeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const name = row.querySelector('td:nth-child(2)').textContent;
                    
                    if (confirm(`ç¡®å®šè¦æ”¶å› ${name} çš„æƒé™å—ï¼Ÿ`)) {
                        // è·å–è¡¨æ ¼çš„tbodyå…ƒç´ ï¼Œç„¶åç§»é™¤æ•´è¡Œ
                        const tbody = row.parentNode;
                        tbody.removeChild(row);
                    }
                });
            });
            
            // ä¸ºå·²æˆæƒç”¨æˆ·è¡¨æ ¼ä¸­çš„æ‰€æœ‰æŸ¥çœ‹æŒ‰é’®æ·»åŠ äº‹ä»¶
            const viewButtons = document.querySelectorAll('#authorized-tab .view-btn');
            viewButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const name = row.querySelector('td:nth-child(2)').textContent;
                    const employeeId = row.querySelector('td:nth-child(3)').textContent;
                    const department = row.querySelector('td:nth-child(4)').textContent;
                    const addTime = row.querySelector('td:nth-child(7)').textContent;
                    const usageCount = row.querySelector('td:nth-child(9)').textContent;
                    
                    // æ¨¡æ‹Ÿæˆæƒå¤‡æ³¨
                    const reasons = {
                        'å¼ ä¸‰': 'éœ€è¦ä½¿ç”¨AIå·¥å…·æå‡å·¥ä½œæ•ˆç‡',
                        'æå››': 'éœ€è¦è°ƒç ”AIäº§å“åŠŸèƒ½',
                        'ç‹äº”': 'äº§å“è®¾è®¡éœ€è¦ä½¿ç”¨AIåŠ©æ‰‹',
                        'èµµå…­': 'éƒ¨é—¨éœ€å¼€å‘é—®ç­”æ™ºèƒ½ä½“ï¼Œçƒ¦è¯·å®¡æ‰¹',
                        'é’±ä¸ƒ': 'å¼€å‘éœ€è¦ä½¿ç”¨AIæ¥å£'
                    };
                    
                    const reason = reasons[name] || 'ç”¨æˆ·ç”³è¯·ä½¿ç”¨ç³»ç»Ÿ';
                    
                    // æ˜¾ç¤ºç”¨æˆ·è¯¦æƒ…
                    showUserDetail(name, employeeId, department, addTime, reason, usageCount);
                });
            });
        });

        // æ·»åŠ è¡¨æ ¼å…¨é€‰/å–æ¶ˆå…¨é€‰åŠŸèƒ½
        function setupTableCheckboxes() {
            // è·å–å·²æˆæƒç”¨æˆ·è¡¨æ ¼çš„è¡¨å¤´å¤é€‰æ¡†
            const authorizedHeaderCheckbox = document.querySelector('#authorized-tab table thead th:first-child input[type="checkbox"]');
            
            // ä¸ºè¡¨å¤´å¤é€‰æ¡†æ·»åŠ ç‚¹å‡»äº‹ä»¶
            if (authorizedHeaderCheckbox) {
                authorizedHeaderCheckbox.addEventListener('change', function() {
                    // è·å–è¡¨æ ¼ä¸­æ‰€æœ‰è¡Œçš„å¤é€‰æ¡†
                    const rowCheckboxes = document.querySelectorAll('#authorized-tab table tbody td:first-child input[type="checkbox"]');
                    
                    // è®¾ç½®æ‰€æœ‰è¡Œçš„å¤é€‰æ¡†çŠ¶æ€ä¸è¡¨å¤´å¤é€‰æ¡†ä¸€è‡´
                    rowCheckboxes.forEach(checkbox => {
                        checkbox.checked = authorizedHeaderCheckbox.checked;
                    });
                    
                    // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çš„çŠ¶æ€
                    updateBatchActionStatus('authorized');
                });
            }
            
            // è·å–å½“å‰ç™»å½•ç”¨æˆ·è¡¨æ ¼çš„è¡¨å¤´å¤é€‰æ¡†
            const activeHeaderCheckbox = document.querySelector('#active-tab table thead th:first-child input[type="checkbox"]');
            
            // ä¸ºè¡¨å¤´å¤é€‰æ¡†æ·»åŠ ç‚¹å‡»äº‹ä»¶
            if (activeHeaderCheckbox) {
                activeHeaderCheckbox.addEventListener('change', function() {
                    // è·å–è¡¨æ ¼ä¸­æ‰€æœ‰è¡Œçš„å¤é€‰æ¡†
                    const rowCheckboxes = document.querySelectorAll('#active-tab table tbody td:first-child input[type="checkbox"]');
                    
                    // è®¾ç½®æ‰€æœ‰è¡Œçš„å¤é€‰æ¡†çŠ¶æ€ä¸è¡¨å¤´å¤é€‰æ¡†ä¸€è‡´
                    rowCheckboxes.forEach(checkbox => {
                        checkbox.checked = activeHeaderCheckbox.checked;
                    });
                    
                    // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çš„çŠ¶æ€
                    updateBatchActionStatus('active');
                });
            }
            
            // ç§»é™¤åŸæ¥çš„å®¡æ‰¹è¡¨æ ¼è¡¨å¤´å¤é€‰æ¡†é€»è¾‘ (ç”±æ–°å‡½æ•°æ›¿ä»£)
            
            // ä¸ºæ¯ä¸ªè¡¨æ ¼ä¸­çš„è¡Œå¤é€‰æ¡†æ·»åŠ äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨å•ä¸ªé€‰æ‹©å˜åŒ–æ—¶æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€
            setupRowCheckboxes('authorized');
            setupRowCheckboxes('active');
            setupApprovalRowCheckboxes(); // ä¸ºå®¡æ‰¹è¡¨æ ¼ä½¿ç”¨ç‰¹æ®Šå¤„ç†
        }

        // è®¾ç½®è¡¨æ ¼è¡Œå¤é€‰æ¡†çš„äº‹ä»¶
        function setupRowCheckboxes(tabId) {
            const rowCheckboxes = document.querySelectorAll(`#${tabId}-tab table tbody td:first-child input[type="checkbox"]`);
            const headerCheckbox = document.querySelector(`#${tabId}-tab table thead th:first-child input[type="checkbox"]`);
            
            rowCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰è¡Œéƒ½è¢«é€‰ä¸­
                    const allChecked = Array.from(rowCheckboxes).every(cb => cb.checked);
                    const anyChecked = Array.from(rowCheckboxes).some(cb => cb.checked);
                    
                    // æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€
                    if (headerCheckbox) {
                        headerCheckbox.checked = allChecked;
                        // å¯ä»¥æ·»åŠ indeterminateçŠ¶æ€è¡¨ç¤ºéƒ¨åˆ†é€‰ä¸­
                        headerCheckbox.indeterminate = anyChecked && !allChecked;
                    }
                    
                    // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çš„çŠ¶æ€
                    updateBatchActionStatus(tabId);
                });
            });
        }

        // åˆå§‹åŒ–é¡µé¢ä¸­æ‰€æœ‰æ‰¹é‡æ“ä½œæŒ‰é’®çš„çŠ¶æ€
        function initBatchActionButtons() {
            // ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µæ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
            updateBatchActionStatus('authorized');
            updateBatchActionStatus('approval');
            updateBatchActionStatus('active');
        }

        // ä¿®æ”¹æ‰¹é‡æ”¶å›æƒé™åŠŸèƒ½
        function setupBatchRemovePermission() {
            // è·å–æ‰¹é‡æ”¶å›æƒé™æŒ‰é’®
            const batchRemoveBtn = document.querySelector('#authorized-tab .batch-actions .remove-btn');
            
            if (batchRemoveBtn) {
                batchRemoveBtn.addEventListener('click', function() {
                    // è·å–æ‰€æœ‰é€‰ä¸­çš„è¡Œå¤é€‰æ¡†
                    const checkedRows = document.querySelectorAll('#authorized-tab table tbody td:first-child input[type="checkbox"]:checked');
                    
                    // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„è¡Œï¼ŒæŒ‰é’®åº”è¯¥æ˜¯ç¦ç”¨çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦é¢å¤–æ£€æŸ¥
                    // ç›´æ¥è·å–é€‰ä¸­ç”¨æˆ·çš„å§“å
                    const selectedUsers = Array.from(checkedRows).map(checkbox => {
                        const row = checkbox.closest('tr');
                        return row.querySelector('td:nth-child(2)').textContent;
                    });
                    
                    // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                    if (confirm(`ç¡®å®šè¦æ”¶å›ä»¥ä¸‹ç”¨æˆ·çš„æƒé™å—ï¼Ÿ\n${selectedUsers.join('\n')}`)) {
                        // éå†é€‰ä¸­çš„è¡Œå¹¶åˆ é™¤
                        checkedRows.forEach(checkbox => {
                            const row = checkbox.closest('tr');
                            if (row && row.parentNode) {
                                row.parentNode.removeChild(row);
                            }
                        });
                        
                        // é‡ç½®è¡¨å¤´å¤é€‰æ¡†
                        const headerCheckbox = document.querySelector('#authorized-tab table thead th:first-child input[type="checkbox"]');
                        if (headerCheckbox) {
                            headerCheckbox.checked = false;
                            headerCheckbox.indeterminate = false;
                        }
                        
                        // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
                        updateBatchActionStatus('authorized');
                    }
                });
            }
        }

        // åœ¨é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®å¤é€‰æ¡†è”åŠ¨
        document.addEventListener('DOMContentLoaded', function() {
            // ...ç°æœ‰çš„DOMContentLoadedäº‹ä»¶å¤„ç†ç¨‹åº...
            
            // è®¾ç½®è¡¨æ ¼å¤é€‰æ¡†è”åŠ¨
            setupTableCheckboxes();
            
            // ä¸“é—¨è®¾ç½®å®¡æ‰¹è¡¨å¤´å¤é€‰æ¡†
            setupApprovalHeaderCheckbox();
            
            // ç¦ç”¨å·²å¤„ç†çš„å®¡æ‰¹å•å¤é€‰æ¡†
            disableProcessedApprovalCheckboxes();
            
            // è®¾ç½®æ‰¹é‡æ”¶å›æƒé™åŠŸèƒ½
            setupBatchRemovePermission();
            
            // åˆå§‹åŒ–æ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€ (ç¦ç”¨)
            initBatchActionButtons();
            
            // åˆå§‹åŒ–æŸ¥çœ‹æŒ‰é’®äº‹ä»¶ï¼Œä»¥æ˜¾ç¤ºå®¡æ‰¹å¤‡æ³¨/æ‹’ç»ç†ç”±
            setupViewButtonEvents();
            
            // åˆå§‹åŒ–å·²å¤„ç†å®¡æ‰¹å•çš„æ•°æ®
            initProcessedApprovalComments();
        });

        // æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥ç¦ç”¨å·²å¤„ç†å®¡æ‰¹å•çš„å¤é€‰æ¡†
        function disableProcessedApprovalCheckboxes() {
            // è·å–æ‰€æœ‰å®¡æ‰¹å•è¡Œ
            const approvalRows = document.querySelectorAll('#approval-tab table tbody tr');
            
            approvalRows.forEach(row => {
                // è·å–çŠ¶æ€åˆ—ï¼Œæ£€æŸ¥æ˜¯å¦ä¸º"å·²é€šè¿‡"æˆ–"å·²æ‹’ç»"
                const statusElement = row.querySelector('td:nth-child(9) .status');
                if (statusElement) {
                    const status = statusElement.textContent;
                    
                    // å¦‚æœæ˜¯å·²å¤„ç†çš„çŠ¶æ€ï¼Œç¦ç”¨å¤é€‰æ¡†
                    if (status === 'å·²é€šè¿‡' || status === 'å·²æ‹’ç»') {
                        const checkbox = row.querySelector('td:first-child input[type="checkbox"]');
                        if (checkbox) {
                            checkbox.disabled = true;
                            checkbox.checked = false; // ç¡®ä¿æœªè¢«é€‰ä¸­
                            checkbox.parentElement.title = 'å·²å¤„ç†çš„å®¡æ‰¹å•ä¸å¯é€‰æ‹©'; // æ·»åŠ æç¤º
                        }
                    }
                }
            });
        }

        // ä¿®æ”¹è¡¨å¤´å¤é€‰æ¡†äº‹ä»¶ï¼Œåªå½±å“æœªç¦ç”¨çš„å¤é€‰æ¡†
        function setupApprovalHeaderCheckbox() {
            const approvalHeaderCheckbox = document.querySelector('#approval-tab table thead th:first-child input[type="checkbox"]');
            
            if (approvalHeaderCheckbox) {
                approvalHeaderCheckbox.addEventListener('change', function() {
                    // åªè·å–æœªç¦ç”¨çš„è¡Œå¤é€‰æ¡†
                    const availableRowCheckboxes = document.querySelectorAll('#approval-tab table tbody td:first-child input[type="checkbox"]:not([disabled])');
                    
                    // è®¾ç½®æ‰€æœ‰å¯ç”¨è¡Œçš„å¤é€‰æ¡†çŠ¶æ€ä¸è¡¨å¤´å¤é€‰æ¡†ä¸€è‡´
                    availableRowCheckboxes.forEach(checkbox => {
                        checkbox.checked = approvalHeaderCheckbox.checked;
                    });
                    
                    // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çš„çŠ¶æ€
                    updateBatchActionStatus('approval');
                });
            }
        }

        // ä¸“é—¨ä¸ºå®¡æ‰¹è¡¨æ ¼è¡Œå¤é€‰æ¡†è®¾ç½®äº‹ä»¶
        function setupApprovalRowCheckboxes() {
            const rowCheckboxes = document.querySelectorAll('#approval-tab table tbody td:first-child input[type="checkbox"]');
            const headerCheckbox = document.querySelector('#approval-tab table thead th:first-child input[type="checkbox"]');
            
            rowCheckboxes.forEach(checkbox => {
                // åªä¸ºæœªç¦ç”¨çš„å¤é€‰æ¡†æ·»åŠ äº‹ä»¶
                if (!checkbox.disabled) {
                    checkbox.addEventListener('change', function() {
                        // è·å–æ‰€æœ‰æœªç¦ç”¨çš„å¤é€‰æ¡†
                        const availableCheckboxes = document.querySelectorAll('#approval-tab table tbody td:first-child input[type="checkbox"]:not([disabled])');
                        
                        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¯ç”¨è¡Œéƒ½è¢«é€‰ä¸­
                        const allChecked = Array.from(availableCheckboxes).every(cb => cb.checked);
                        const anyChecked = Array.from(availableCheckboxes).some(cb => cb.checked);
                        
                        // æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€
                        if (headerCheckbox) {
                            headerCheckbox.checked = allChecked;
                            // å¯ä»¥æ·»åŠ indeterminateçŠ¶æ€è¡¨ç¤ºéƒ¨åˆ†é€‰ä¸­
                            headerCheckbox.indeterminate = anyChecked && !allChecked;
                        }
                        
                        // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çš„çŠ¶æ€
                        updateBatchActionStatus('approval');
                    });
                }
            });
        }

        // ä¸ºæŸ¥çœ‹æŒ‰é’®ç»‘å®šäº‹ä»¶ï¼Œæ˜¾ç¤ºåŒ…å«å®¡æ‰¹å¤‡æ³¨/æ‹’ç»ç†ç”±çš„ç”¨æˆ·è¯¦æƒ…
        function setupViewButtonEvents() {
            const viewButtons = document.querySelectorAll('.view-btn');
            viewButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // è·å–å½“å‰è¡Œçš„æ•°æ®
                    const row = this.closest('tr');
                    
                    // ç¡®å®šå½“å‰æ˜¯å“ªä¸ªæ ‡ç­¾é¡µ
                    const tabId = row.closest('.tab-content').id;
                    
                    // æ ¹æ®æ ‡ç­¾é¡µè°ƒç”¨ä¸åŒçš„è¯¦æƒ…å±•ç¤ºå‡½æ•°
                    if (tabId === 'approval-tab') {
                        showApprovalDetails(row);
                    } else if (tabId === 'authorized-tab') {
                        showAuthorizedUserDetails(row);
                    } else if (tabId === 'active-tab') {
                        showActiveUserDetails(row);
                    }
                });
            });
        }

        // æƒé™å®¡æ‰¹è¯¦æƒ…å±•ç¤ºå‡½æ•°
        function showApprovalDetails(row) {
            // è·å–åŸºæœ¬ç”¨æˆ·ä¿¡æ¯
            const name = row.querySelector('td:nth-child(2)').textContent.trim();
            // const jobId = row.querySelector('td:nth-child(3)').textContent.trim();
            const department = row.querySelector('td:nth-child(4)').textContent.trim();
            const platform = row.querySelector('td:nth-child(5)').textContent.trim();
            const role = row.querySelector('td:nth-child(6)').textContent.trim();
            const applyTime = row.querySelector('td:nth-child(7)').textContent.trim();
            const reason = row.querySelector('td:nth-child(8)').textContent.trim();
            
            // è·å–çŠ¶æ€å’Œå®¡æ‰¹ä¿¡æ¯
            const statusEl = row.querySelector('td:nth-child(9) .status');
            const status = statusEl ? statusEl.textContent.trim() : 'å¾…å®¡æ‰¹';
            
            let approvalComment = '';
            if (status === 'å·²é€šè¿‡') {
                approvalComment = row.getAttribute('data-approval-comment') || '';
            } else if (status === 'å·²æ‹’ç»') {
                approvalComment = row.getAttribute('data-rejection-reason') || '';
            }
            
            // è¡¥å……å…¶ä»–ä¿¡æ¯
            let email = '';
            let position = '';
            
            // æ ¹æ®ä¸åŒç”¨æˆ·è®¾ç½®ä¸åŒä¿¡æ¯
            if (name.includes('å¼ ä¸‰')) {
                email = 'zhangsan';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('æå››')) {
                email = 'lisi';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('ç‹äº”')) {
                email = 'wangwu';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('èµµå…­')) {
                email = 'zhaoliu';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('é’±ä¸ƒ')) {
                email = 'qianqi';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('åˆ˜äºŒ')) {
                email = 'liuer';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            }
            
            // æ„å»ºæ¨¡æ€æ¡†å†…å®¹
            let modalContent = `
                <div class="modal-header">
                    <h3>ç”³è¯·è¯¦æƒ… - ${name}</h3>
                    <span class="close-btn">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="detail-section">
                        <h4>ç”³è¯·ä¿¡æ¯</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">ç”³è¯·äºº</div>
                                <div class="detail-value">${name}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æ‰€å±éƒ¨é—¨</div>
                                <div class="detail-value">${department}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">å²—ä½åç§°</div>
                                <div class="detail-value">${position}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">åŸŸè´¦å·</div>
                                <div class="detail-value">${email}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">ç”³è¯·æ—¶é—´</div>
                                <div class="detail-value">${applyTime}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4>ç”³è¯·åŸå› </h4>
                        <div class="detail-remarks" style="border-left-color: #faad14; background-color: #fffbe6;">
                            ${reason}
                        </div>
                    </div>`;
            
            // æ ¹æ®çŠ¶æ€æ·»åŠ å®¡æ‰¹å¤‡æ³¨æˆ–æ‹’ç»ç†ç”±
            if (status === 'å·²é€šè¿‡' && approvalComment) {
                modalContent += `
                    <div class="detail-section">
                        <h4>å®¡æ‰¹å¤‡æ³¨</h4>
                        <div class="detail-remarks" style="border-left-color: #52c41a; background-color: #f6ffed;">
                            ${approvalComment}
                        </div>
                    </div>`;
            } else if (status === 'å·²æ‹’ç»' && approvalComment) {
                modalContent += `
                    <div class="detail-section">
                        <h4>æ‹’ç»ç†ç”±</h4>
                        <div class="detail-remarks" style="border-left-color: #f5222d; background-color: #fff1f0;">
                            ${approvalComment}
                        </div>
                    </div>`;
            }
            
            // æ·»åŠ åº•éƒ¨æŒ‰é’®
            modalContent += `
                </div>
                <div class="modal-footer">
                    <button class="modal-btn cancel-btn">å…³é—­</button>
                </div>
            `;
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            showModalWithContent('user-detail-modal', modalContent);
        }

        // å·²æˆæƒç”¨æˆ·è¯¦æƒ…å±•ç¤ºå‡½æ•°
        function showAuthorizedUserDetails(row) {
            // è·å–åŸºæœ¬ç”¨æˆ·ä¿¡æ¯
            const name = row.querySelector('td:nth-child(2)').textContent.trim();
            // const jobId = row.querySelector('td:nth-child(3)').textContent.trim();
            const department = row.querySelector('td:nth-child(4)').textContent.trim();
            const platform = row.querySelector('td:nth-child(5)').textContent.trim();
            const role = row.querySelector('td:nth-child(6)').textContent.trim();
            const applyTime = row.querySelector('td:nth-child(7)').textContent.trim();
            
            // è¡¥å……å…¶ä»–ä¿¡æ¯
            let email = '';
            let position = '';
            
            // æ ¹æ®ä¸åŒç”¨æˆ·è®¾ç½®ä¸åŒä¿¡æ¯
            if (name.includes('å¼ ä¸‰')) {
                email = 'zhangsan';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('æå››')) {
                email = 'lisi';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('ç‹äº”')) {
                email = 'wangwu';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('èµµå…­')) {
                email = 'zhaoliu';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('é’±ä¸ƒ')) {
                email = 'qianqi';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('åˆ˜äºŒ')) {
                email = 'liuer';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            }
            
            // æ„å»ºæ¨¡æ€æ¡†å†…å®¹ - ç§»é™¤äº†ç”³è¯·åŸå› éƒ¨åˆ†
            let modalContent = `
                <div class="modal-header">
                    <h3>æƒé™è¯¦æƒ… - ${name}</h3>
                    <span class="close-btn">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="detail-section">
                        <h4>ç”¨æˆ·ä¿¡æ¯</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">ç”¨æˆ·å</div>
                                <div class="detail-value">${name}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æ‰€å±éƒ¨é—¨</div>
                                <div class="detail-value">${department}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æ‰€å±å¹³å°</div>
                                <div class="detail-value">${platform}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">å²—ä½åç§°</div>
                                <div class="detail-value">${position}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">åŸŸè´¦å·</div>
                                <div class="detail-value">${email}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æˆæƒæ—¶é—´</div>
                                <div class="detail-value">${applyTime}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æˆæƒæ–¹å¼</div>
                                <div class="detail-value">ç›´æ¥æˆæƒ</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn cancel-btn">å…³é—­</button>
                </div>
            `;
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            showModalWithContent('user-detail-modal', modalContent);
        }

        // å½“å‰ç™»å½•ç”¨æˆ·è¯¦æƒ…å±•ç¤ºå‡½æ•°
        function showActiveUserDetails(row) {
            // è·å–åŸºæœ¬ç”¨æˆ·ä¿¡æ¯
            const name = row.querySelector('td:nth-child(2)').textContent.trim();
            // const jobId = row.querySelector('td:nth-child(3)').textContent.trim();
            const department = row.querySelector('td:nth-child(4)').textContent.trim();
            const platform = row.querySelector('td:nth-child(5)').textContent.trim();
            const role = row.querySelector('td:nth-child(6)').textContent.trim();
            const statusEl = row.querySelector('td:nth-child(7)');
            const status = statusEl ? statusEl.textContent.trim() : 'åœ¨çº¿';
            
            // è¡¥å……å…¶ä»–ä¿¡æ¯
            let email = '';
            let position = '';
            
            // æ ¹æ®ä¸åŒç”¨æˆ·è®¾ç½®ä¸åŒä¿¡æ¯
            if (name.includes('å¼ ä¸‰')) {
                email = 'zhangsan';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('æå››')) {
                email = 'lisi';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('ç‹äº”')) {
                email = 'wangwu';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('èµµå…­')) {
                email = 'zhaoliu';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('é’±ä¸ƒ')) {
                email = 'qianqi';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            } else if (name.includes('åˆ˜äºŒ')) {
                email = 'liuer';
                position = 'é«˜çº§Javaå¼€å‘å·¥ç¨‹å¸ˆ';
            }
            
            // ç”Ÿæˆéšæœºçš„æµè§ˆå™¨ä¿¡æ¯
            const browsers = [
                'Chrome 96.0.4664.110', 
                'Firefox 95.0.2', 
                'Edge 97.0.1072.69', 
                'Safari 15.2', 
                'Chrome 97.0.4692.71'
            ];
            const randomBrowser = browsers[Math.floor(Math.random() * browsers.length)];
            
            // è·å–å½“å‰æ—¥æœŸæ—¶é—´
            const currentDate = new Date();
            const formattedDateTime = currentDate.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            }).replace(/\//g, '-');
            
            // æ„å»ºæ¨¡æ€æ¡†å†…å®¹
            let modalContent = `
                <div class="modal-header">
                    <h3>åœ¨çº¿ç”¨æˆ·è¯¦æƒ… - ${name}</h3>
                    <span class="close-btn">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="detail-section">
                        <h4>ç”¨æˆ·ä¿¡æ¯</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">ç”¨æˆ·å</div>
                                <div class="detail-value">${name}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æ‰€å±éƒ¨é—¨</div>
                                <div class="detail-value">${department}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">å²—ä½åç§°</div>
                                <div class="detail-value">${position}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">åŸŸè´¦å·</div>
                                <div class="detail-value">${email}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">ç™»å½•æ—¶é—´</div>
                                <div class="detail-value">${formattedDateTime}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">IPåœ°å€</div>
                                <div class="detail-value">192.168.1.${Math.floor(Math.random() * 255) + 1}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">ç™»å½•è®¾å¤‡</div>
                                <div class="detail-value">${randomBrowser}</div>
                            </div>
                        </div>
                    </div>`;
            
            // åˆ›å»º3æ¡éšæœºçš„ç™»å½•è®°å½•ï¼Œæ—¥æœŸé€æ¸å¾€å‰
            const loginRecords = [];
            for (let i = 0; i < 3; i++) {
                // åˆ›å»ºæ—¶é—´åç§»ï¼Œæ¯æ¬¡å¤šä¸€äº›
                const offset = (i === 0) ? 2 : (i === 1) ? 6 : 24; // å°æ—¶åç§»
                
                // è®¡ç®—æ—¥æœŸå’Œæ ¼å¼åŒ–
                const recordDate = new Date(Date.now() - offset * 3600000);
                const formattedDate = recordDate.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }).replace(/\//g, '-');
                
                // éšæœºæµè§ˆå™¨å’ŒIP
                const loginBrowser = browsers[Math.floor(Math.random() * browsers.length)];
                const loginIP = `192.168.1.${Math.floor(Math.random() * 255) + 1}`;
                
                loginRecords.push({
                    time: formattedDate,
                    browser: loginBrowser,
                    ip: loginIP
                });
            }
            
            // æ·»åŠ ç™»å½•è®°å½•è¡¨æ ¼
            modalContent += `
                <div class="detail-section">
                    <h4>ç™»å½•è®°å½•</h4>
                    <table class="detail-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>ç™»å½•æ—¶é—´</th>
                                <th>ç™»å½•è®¾å¤‡</th>
                                <th>IPåœ°å€</th>
                            </tr>
                        </thead>
                        <tbody>`;
            
            // æ·»åŠ æ¯æ¡ç™»å½•è®°å½•
            loginRecords.forEach(record => {
                modalContent += `
                            <tr>
                                <td>${record.time}</td>
                                <td>${record.browser}</td>
                                <td>${record.ip}</td>
                            </tr>`;
            });
            
            modalContent += `
                        </tbody>
                    </table>
                </div>`;
            
            // æ·»åŠ åº•éƒ¨æŒ‰é’®
            modalContent += `
                </div>
                <div class="modal-footer">
                    <button class="modal-btn cancel-btn">å…³é—­</button>
                </div>
            `;
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            showModalWithContent('user-detail-modal', modalContent);
        }

        // è¾…åŠ©å‡½æ•°ï¼šæ˜¾ç¤ºå¸¦æœ‰ç‰¹å®šå†…å®¹çš„æ¨¡æ€æ¡†
        function showModalWithContent(modalId, content) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            // è®¾ç½®æ¨¡æ€æ¡†å†…å®¹
            modal.querySelector('.modal-content').innerHTML = content;
            
            // ä¸ºå…³é—­æŒ‰é’®æ·»åŠ äº‹ä»¶
            const closeBtn = modal.querySelector('.close-btn');
            const cancelBtn = modal.querySelector('.cancel-btn');
            
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    modal.style.display = 'none';
                });
            }
            
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    modal.style.display = 'none';
                });
            }
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.style.display = 'flex';
        }

        // åˆå§‹åŒ–å·²å¤„ç†å®¡æ‰¹å•çš„æ•°æ®å±æ€§ - ä¿®æ”¹ä¸ºä»…æ£€æŸ¥çŠ¶æ€ï¼Œä¸æ·»åŠ é»˜è®¤å¤‡æ³¨
        function initProcessedApprovalComments() {
            // è·å–æ‰€æœ‰å·²å¤„ç†çš„å®¡æ‰¹å•è¡Œ
            const approvedRows = document.querySelectorAll('#approval-tab tbody tr:has(td:nth-child(9) .status-approved)');
            const rejectedRows = document.querySelectorAll('#approval-tab tbody tr:has(td:nth-child(9) .status-rejected)');
            
            // æ£€æŸ¥å·²é€šè¿‡çš„è¡Œæ˜¯å¦æœ‰å®¡æ‰¹å¤‡æ³¨å±æ€§
            approvedRows.forEach(row => {
                // ä»…ç¡®ä¿æœ‰å±æ€§ï¼Œä¸å¡«å……é»˜è®¤å€¼
                if (!row.hasAttribute('data-approval-comment')) {
                    row.setAttribute('data-approval-comment', '');
                }
            });
            
            // æ£€æŸ¥å·²æ‹’ç»çš„è¡Œæ˜¯å¦æœ‰æ‹’ç»ç†ç”±å±æ€§
            rejectedRows.forEach(row => {
                // ä»…ç¡®ä¿æœ‰å±æ€§ï¼Œä¸å¡«å……é»˜è®¤å€¼
                if (!row.hasAttribute('data-rejection-reason')) {
                    row.setAttribute('data-rejection-reason', '');
                }
            });
        }

        // ä¸ºåˆå§‹åŒ–æ•°æ®æ·»åŠ å®¡æ‰¹å¤‡æ³¨/æ‹’ç»ç†ç”±
        function initSampleApprovalComments() {
            // è·å–æ‰€æœ‰å·²å¤„ç†çš„å®¡æ‰¹å•è¡Œ
            const rows = document.querySelectorAll('#approval-tab tbody tr');
            
            rows.forEach(row => {
                const statusCell = row.querySelector('td:nth-child(9)');
                const statusText = statusCell ? statusCell.textContent.trim() : '';
                const name = row.querySelector('td:nth-child(2)').textContent.trim();
                
                // ä¸ºå·²é€šè¿‡çš„è¡Œæ·»åŠ å®¡æ‰¹å¤‡æ³¨
                if (statusText.includes('å·²é€šè¿‡')) {
                    let comment = 'å·²æ ¸å®ç”¨æˆ·èº«ä»½å’Œéœ€æ±‚ï¼Œç¬¦åˆå…¬å¸å®‰å…¨æ”¿ç­–è¦æ±‚ï¼Œäºˆä»¥æ‰¹å‡†ã€‚';
                    
                    // æ ¹æ®ç”¨æˆ·åè®¾ç½®ä¸åŒçš„å¤‡æ³¨
                    if (name === 'å¼ ä¸‰') {
                        comment += ' ç”¨æˆ·æ˜¯ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨é—¨æ ¸å¿ƒæˆå‘˜ï¼Œéœ€ä½¿ç”¨æ­¤æƒé™å¤„ç†å®¢æˆ·åé¦ˆé—®é¢˜ã€‚';
                    } else if (name === 'æå››') {
                        comment += ' ç”¨æˆ·éœ€çŸ­æœŸè®¿é—®ç³»ç»Ÿè¿›è¡Œå¸‚åœºæ•°æ®åˆ†æã€‚';
                    } else if (name === 'ç‹äº”') {
                        comment += ' ç”¨æˆ·æ˜¯äº§å“æ ¸å¿ƒæˆå‘˜ï¼Œéœ€è¦é•¿æœŸä½¿ç”¨æ­¤åŠŸèƒ½ã€‚';
                    }
                    
                    row.setAttribute('data-approval-comment', comment);
                }
                
                // ä¸ºå·²æ‹’ç»çš„è¡Œæ·»åŠ æ‹’ç»ç†ç”±
                if (statusText.includes('å·²æ‹’ç»')) {
                    let reason = 'ç”³è¯·ç”¨é€”ä¸ç”¨æˆ·å²—ä½èŒè´£ä¸ç¬¦ï¼Œæ— æ³•ç¡®è®¤ä¸šåŠ¡éœ€æ±‚çš„çœŸå®æ€§ã€‚';
                    
                    // æ ¹æ®ç”¨æˆ·åè®¾ç½®ä¸åŒçš„ç†ç”±
                    if (name === 'èµµå…­') {
                        reason += ' ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-äººåŠ›èµ„æºéƒ¨éƒ¨éƒ¨éƒ¨é—¨äººå‘˜æ— æƒé™è®¿é—®è¯¥ç³»ç»Ÿçš„æ•æ„Ÿæ•°æ®ã€‚';
                    } else if (name === 'é’±ä¸ƒ') {
                        reason += ' è¯¥æƒé™éœ€è¦ç”±éƒ¨é—¨ä¸»ç®¡æå‡ºç”³è¯·ï¼Œè¯·æŒ‰æ­£è§„æµç¨‹é‡æ–°ç”³è¯·ã€‚';
                    }
                    
                    row.setAttribute('data-rejection-reason', reason);
                }
            });
        }

        // æ·»åŠ è°ƒè¯•å‡½æ•°
        function debugApprovalComments() {
            console.log('è°ƒè¯•å®¡æ‰¹å¤‡æ³¨/æ‹’ç»ç†ç”±:');
            
            // è·å–æ‰€æœ‰è¡Œ
            const rows = document.querySelectorAll('#approval-tab tbody tr');
            
            rows.forEach((row, index) => {
                const name = row.querySelector('td:nth-child(2)').textContent.trim();
                const statusCell = row.querySelector('td:nth-child(9)');
                const statusText = statusCell ? statusCell.textContent.trim() : 'å¾…å®¡æ‰¹';
                const approvalComment = row.getAttribute('data-approval-comment');
                const rejectionReason = row.getAttribute('data-rejection-reason');
                
                console.log(`è¡Œ ${index+1} - ${name}:`);
                console.log('  çŠ¶æ€:', statusText);
                console.log('  å®¡æ‰¹å¤‡æ³¨:', approvalComment || 'æ— ');
                console.log('  æ‹’ç»ç†ç”±:', rejectionReason || 'æ— ');
            });
        }

        // åœ¨åˆå§‹åŒ–åè°ƒç”¨è°ƒè¯•å‡½æ•°
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ ·ä¾‹æ•°æ®çš„å®¡æ‰¹å¤‡æ³¨/æ‹’ç»ç†ç”±
            initSampleApprovalComments();
            
            // åˆå§‹åŒ–æŸ¥çœ‹æŒ‰é’®äº‹ä»¶
            setupViewButtonEvents();
            
            // è°ƒè¯•è¾“å‡º
            setTimeout(debugApprovalComments, 1000);
            
            // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...
        });

        // ä¸ºè¡¨æ ¼å¤é€‰æ¡†æ·»åŠ äº‹ä»¶å¤„ç†ï¼ˆé€šç”¨å‡½æ•°ï¼‰
        function setupAllCheckboxEvents() {
            // ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µè®¾ç½®å¤é€‰æ¡†äº‹ä»¶
            setupTabCheckboxEvents('approval');
            setupTabCheckboxEvents('authorized');
            setupTabCheckboxEvents('active');
        }

        // ä¸ºå•ä¸ªæ ‡ç­¾é¡µçš„è¡¨æ ¼å¤é€‰æ¡†æ·»åŠ äº‹ä»¶å¤„ç†
        function setupTabCheckboxEvents(tabName) {
            // è·å–è¡¨å¤´å¤é€‰æ¡†
            const headerCheckbox = document.querySelector(`#${tabName}-tab table thead th:first-child input[type="checkbox"]`);
            
            // è·å–æ‰€æœ‰è¡Œå¤é€‰æ¡†
            const rowCheckboxes = document.querySelectorAll(`#${tabName}-tab table tbody td:first-child input[type="checkbox"]`);
            
            // ä¸ºè¡¨å¤´å¤é€‰æ¡†æ·»åŠ äº‹ä»¶
            if (headerCheckbox) {
                headerCheckbox.addEventListener('change', function() {
                    // è·å–æ‰€æœ‰æœªç¦ç”¨çš„è¡Œå¤é€‰æ¡†
                    const availableCheckboxes = document.querySelectorAll(`#${tabName}-tab table tbody td:first-child input[type="checkbox"]:not([disabled])`);
                    
                    // è®¾ç½®æ‰€æœ‰å¯ç”¨å¤é€‰æ¡†çš„çŠ¶æ€ä¸è¡¨å¤´å¤é€‰æ¡†ä¸€è‡´
                    availableCheckboxes.forEach(checkbox => {
                        checkbox.checked = headerCheckbox.checked;
                    });
                    
                    // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
                    const checkedCount = headerCheckbox.checked ? availableCheckboxes.length : 0;
                    updateBatchActionButtons(tabName, checkedCount);
                });
            }
            
            // ä¸ºæ‰€æœ‰è¡Œå¤é€‰æ¡†æ·»åŠ äº‹ä»¶
            rowCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€å’Œæ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
                    updateTableHeaderCheckboxState(tabName);
                });
            });
        }

        // æ‰¹é‡å®¡æ‰¹æ“ä½œå¼¹çª—æ ·å¼è®¾ç½®
        function setupModalStyles() {
            // è·å–å®¡æ‰¹æ“ä½œæ¨¡æ€æ¡†
            const modal = document.getElementById('approval-action-modal');
            if (!modal) return;
            
            // æ·»åŠ å¼ºè°ƒæ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                .approval-count {
                    font-size: 16px;
                    background-color: #1890ff;
                    color: white;
                    padding: 3px 8px;
                    border-radius: 12px;
                    margin-left: 10px;
                    display: inline-block;
                }
            `;
            document.head.appendChild(style);
        }

        // æ ¼å¼åŒ–æ‰¹é‡æ“ä½œæ ‡é¢˜
        function formatBatchTitle(action, count) {
            return `
                <span>${action === 'approve' ? 'æ‰¹é‡é€šè¿‡' : 'æ‰¹é‡æ‹’ç»'}</span>
                <span class="approval-count">${count}æ¡</span>
            `;
        }

        // åœ¨ batchApprovalAction å‡½æ•°ä¸­è®¾ç½®æ ‡é¢˜æ—¶è°ƒç”¨
        // å°†
        // modal.querySelector('.modal-header h3').textContent = `æ‰¹é‡é€šè¿‡ (${checkedRows.length}æ¡)`;
        // æ”¹ä¸º
        // modal.querySelector('.modal-header h3').innerHTML = formatBatchTitle(action, checkedRows.length);

        // åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ ·å¼
        document.addEventListener('DOMContentLoaded', function() {
            // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...
            
            // è®¾ç½®æ¨¡æ€æ¡†æ ·å¼
            setupModalStyles();
            
            // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...
        });

        // æ‰¹é‡æ”¶å›æƒé™æ“ä½œ
        function batchRevokePermission() {
            // è·å–æ‰€æœ‰é€‰ä¸­çš„è¡Œ
            // const checkedRows = document.querySelectorAll('#authorized-tab table tbody td:first-child input[type="checkbox"]:checked:not([disabled])');
            
            // if (checkedRows.length === 0) {
            //     alert('è¯·å…ˆé€‰æ‹©è¦æ”¶å›æƒé™çš„ç”¨æˆ·');
            //     return;
            // }
            
            // ç¡®è®¤æ“ä½œ
            if (!confirm(`ç¡®å®šè¦æ”¶å› ${checkedRows.length} åç”¨æˆ·çš„æƒé™å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) {
                return;
            }
            
            // æ‰§è¡Œæ‰¹é‡æ”¶å›æ“ä½œ
            checkedRows.forEach(checkbox => {
                const row = checkbox.closest('tr');
                revokePermission(row);
            });
            
            // æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€
            updateTableHeaderCheckboxState('authorized');
            
            // æ˜¾ç¤ºæ“ä½œæˆåŠŸæ¶ˆæ¯
            alert(`å·²æˆåŠŸæ”¶å› ${checkedRows.length} åç”¨æˆ·çš„æƒé™`);
        }

        // æ‰¹é‡å¼ºåˆ¶é€€å‡ºæ“ä½œ
        function batchForceLogout() {
            // è·å–æ‰€æœ‰é€‰ä¸­çš„è¡Œ
            const checkedRows = document.querySelectorAll('#active-tab table tbody td:first-child input[type="checkbox"]:checked:not([disabled])');
            
            if (checkedRows.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦å¼ºåˆ¶é€€å‡ºçš„ç”¨æˆ·');
                return;
            }
            
            // ç¡®è®¤æ“ä½œ
            if (!confirm(`ç¡®å®šè¦å¼ºåˆ¶ ${checkedRows.length} åç”¨æˆ·é€€å‡ºç™»å½•å—ï¼Ÿè¿™å°†ä¸­æ–­ä»–ä»¬å½“å‰çš„æ“ä½œã€‚`)) {
                return;
            }
            
            // æ‰§è¡Œæ‰¹é‡å¼ºåˆ¶é€€å‡ºæ“ä½œ
            checkedRows.forEach(checkbox => {
                const row = checkbox.closest('tr');
                forceLogout(row);
            });
            
            // æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€
            updateTableHeaderCheckboxState('active');
            
            // æ˜¾ç¤ºæ“ä½œæˆåŠŸæ¶ˆæ¯
            alert(`å·²æˆåŠŸå¼ºåˆ¶ ${checkedRows.length} åç”¨æˆ·é€€å‡ºç™»å½•`);
        }

        // æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€å’Œæ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€ï¼ˆé€šç”¨å‡½æ•°ï¼‰
        function updateTableHeaderCheckboxState(tabName) {
            const availableCheckboxes = document.querySelectorAll(`#${tabName}-tab table tbody td:first-child input[type="checkbox"]:not([disabled])`);
            const checkedCheckboxes = document.querySelectorAll(`#${tabName}-tab table tbody td:first-child input[type="checkbox"]:checked:not([disabled])`);
            const headerCheckbox = document.querySelector(`#${tabName}-tab table thead th:first-child input[type="checkbox"]`);
            
            if (headerCheckbox && availableCheckboxes.length > 0) {
                const allChecked = Array.from(availableCheckboxes).every(cb => cb.checked);
                const anyChecked = Array.from(availableCheckboxes).some(cb => cb.checked);
                
                headerCheckbox.checked = allChecked;
                headerCheckbox.indeterminate = anyChecked && !allChecked;
            } else if (headerCheckbox) {
                // å¦‚æœæ²¡æœ‰å¯ç”¨çš„å¤é€‰æ¡†ï¼Œåˆ™å–æ¶ˆé€‰ä¸­è¡¨å¤´å¤é€‰æ¡†
                headerCheckbox.checked = false;
                headerCheckbox.indeterminate = false;
            }
            
            // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
            updateBatchActionButtons(tabName, checkedCheckboxes.length);
        }

        // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€å’Œæ•°é‡æ˜¾ç¤º
        function updateBatchActionButtons(tabName, checkedCount) {
            // è·å–å¯¹åº”æ ‡ç­¾é¡µçš„æ‰¹é‡æ“ä½œæŒ‰é’®
            let batchButtons = [];
            
            if (tabName === 'approval') {
                // å®¡æ‰¹æ ‡ç­¾é¡µ
                batchButtons = [
                    { el: document.querySelector(`#${tabName}-tab .batch-actions .approve-btn`), text: 'æ‰¹é‡é€šè¿‡' },
                    { el: document.querySelector(`#${tabName}-tab .batch-actions .reject-btn`), text: 'æ‰¹é‡æ‹’ç»' }
                ];
            } else if (tabName === 'authorized') {
                // å·²æˆæƒæ ‡ç­¾é¡µ
                batchButtons = [
                    { el: document.querySelector(`#${tabName}-tab .batch-actions .remove-btn`), text: 'æ‰¹é‡æ”¶å›æƒé™' }
                ];
            } else if (tabName === 'active') {
                // åœ¨çº¿ç”¨æˆ·æ ‡ç­¾é¡µ
                batchButtons = [
                    { el: document.querySelector(`#${tabName}-tab .batch-actions .force-logout-btn`), text: 'æ‰¹é‡å¼ºåˆ¶é€€å‡º' }
                ];
            }
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬å’ŒçŠ¶æ€
            batchButtons.forEach(button => {
                if (button.el) {
                    if (checkedCount > 0) {
                        button.el.classList.remove('disabled');
                        button.el.textContent = `${button.text} (${checkedCount})`;
                    } else {
                        button.el.classList.add('disabled');
                        button.el.textContent = button.text;
                    }
                }
            });
        }

        // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ‰€æœ‰å¤é€‰æ¡†äº‹ä»¶å’Œæ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...
            
            // è®¾ç½®æ‰€æœ‰æ ‡ç­¾é¡µçš„å¤é€‰æ¡†äº‹ä»¶
            setupAllCheckboxEvents();
            
            // åˆå§‹åŒ–æ‰€æœ‰æ ‡ç­¾é¡µçš„æ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
            updateBatchActionButtons('approval', 0);
            updateBatchActionButtons('authorized', 0);
            updateBatchActionButtons('active', 0);
            
            // æ·»åŠ æ‰¹é‡æ”¶å›å’Œæ‰¹é‡å¼ºåˆ¶é€€å‡ºçš„äº‹ä»¶å¤„ç†
            setupBatchActionEvents();
            
            // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...
        });

        // è®¾ç½®æ‰¹é‡æ“ä½œæŒ‰é’®çš„äº‹ä»¶å¤„ç†
        function setupBatchActionEvents() {
            // æ‰¹é‡æ”¶å›æƒé™æŒ‰é’®
            const batchRevokeBtn = document.querySelector('#authorized-tab .batch-actions .remove-btn');
            if (batchRevokeBtn) {
                batchRevokeBtn.addEventListener('click', batchRevokePermission);
            }
            
            // æ‰¹é‡å¼ºåˆ¶é€€å‡ºæŒ‰é’®
            const batchLogoutBtn = document.querySelector('#active-tab .batch-actions .force-logout-btn');
            if (batchLogoutBtn) {
                batchLogoutBtn.addEventListener('click', batchForceLogout);
            }
            
            // ... å®¡æ‰¹ç›¸å…³çš„æ‰¹é‡æŒ‰é’®äº‹ä»¶å·²åœ¨å…¶ä»–åœ°æ–¹è®¾ç½® ...
        }

        // æ”¶å›ç”¨æˆ·æƒé™æ“ä½œ
        function revokePermission(row) {
            if (!row) return;
            
            // ä»è¡¨æ ¼ä¸­ç§»é™¤è¯¥è¡Œ
            row.parentNode.removeChild(row);
            
            // æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€å’Œæ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
            updateTableHeaderCheckboxState('authorized');
            
            // å¯ä»¥æ·»åŠ å®é™…çš„åç«¯æ“ä½œä»£ç ï¼Œä¾‹å¦‚å‘é€APIè¯·æ±‚
            console.log('å·²æ”¶å›ç”¨æˆ·æƒé™');
        }

        // å¼ºåˆ¶ç”¨æˆ·é€€å‡ºæ“ä½œ
        function forceLogout(row) {
            if (!row) return;
            
            // ä¿®æ”¹ç”¨æˆ·çŠ¶æ€ä¸º"å·²å¼ºåˆ¶é€€å‡º"
            const statusCell = row.querySelector('td:nth-child(7)');
            if (statusCell) {
                statusCell.innerHTML = '<span class="status status-rejected">å·²å¼ºåˆ¶é€€å‡º</span>';
            }
            
            // ç¦ç”¨å¤é€‰æ¡†
            const checkbox = row.querySelector('td:first-child input[type="checkbox"]');
            if (checkbox) {
                checkbox.disabled = true;
                checkbox.checked = false;
            }
            
            // ä¿®æ”¹æ“ä½œæŒ‰é’®
            const actionsCell = row.querySelector('td:last-child');
            if (actionsCell) {
                actionsCell.innerHTML = '<button class="action-btn view-btn">æŸ¥çœ‹</button>';
            }
            
            // æ›´æ–°è¡¨å¤´å¤é€‰æ¡†çŠ¶æ€å’Œæ‰¹é‡æ“ä½œæŒ‰é’®çŠ¶æ€
            updateTableHeaderCheckboxState('active');
            
            // å¯ä»¥æ·»åŠ å®é™…çš„åç«¯æ“ä½œä»£ç ï¼Œä¾‹å¦‚å‘é€APIè¯·æ±‚
            console.log('å·²å¼ºåˆ¶ç”¨æˆ·é€€å‡º');
        }

        // å¼ºåˆ¶é€€å‡ºåŠŸèƒ½
        function forceLogout(btn) {
            const row = btn.closest('tr');
            const name = row.querySelector('td:nth-child(2)').textContent.trim();
            const loginDevice = row.querySelector('td:nth-child(8)').textContent.trim();
            const ipAddress = row.querySelector('td:nth-child(7)').textContent.trim();
            
            if (confirm(`ç¡®å®šè¦å¼ºåˆ¶ ${name} é€€å‡ºç™»å½•å—ï¼Ÿ`)) {
                // åˆ é™¤è¡Œ
                row.remove();
                
                // è®°å½•ç³»ç»Ÿæ—¥å¿—
                const logData = {
                    type: 'force-logout',
                    userName: name,
                    operatorName: 'æˆ´å€šå‡¡', // å½“å‰ç™»å½•ç®¡ç†å‘˜
                    device: loginDevice,
                    ip: ipAddress,
                    timestamp: new Date().getTime()
                };
                
                // è·å–ç°æœ‰æ—¥å¿—
                const storedLogs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
                storedLogs.push(logData);
                localStorage.setItem('systemLogs', JSON.stringify(storedLogs));
                
                // æ£€æŸ¥è¡¨æ ¼æ˜¯å¦ä¸ºç©º
                checkEmptyTable();
                
                // æ˜¾ç¤ºæ¶ˆæ¯
                alert(`å·²å¼ºåˆ¶ ${name} é€€å‡ºç™»å½•`);
            }
        }

        // æ‰¹é‡å¼ºåˆ¶é€€å‡º
        function batchForceLogout() {
            const selectedRows = document.querySelectorAll('#active-tab tbody tr input[type="checkbox"]:checked');
            const count = selectedRows.length;
            
            if (count === 0) {
                alert('è¯·é€‰æ‹©è¦å¼ºåˆ¶é€€å‡ºçš„ç”¨æˆ·');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦å¼ºåˆ¶é€‰ä¸­çš„ ${count} åç”¨æˆ·é€€å‡ºç™»å½•å—ï¼Ÿ`)) {
                const storedLogs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
                
                // å¤„ç†æ¯ä¸€è¡Œ
                selectedRows.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    const name = row.querySelector('td:nth-child(2)').textContent.trim();
                    const loginDevice = row.querySelector('td:nth-child(8)').textContent.trim();
                    const ipAddress = row.querySelector('td:nth-child(7)').textContent.trim();
                    
                    // è®°å½•ç³»ç»Ÿæ—¥å¿—
                    const logData = {
                        type: 'force-logout',
                        userName: name,
                        operatorName: 'æˆ´å€šå‡¡', // å½“å‰ç™»å½•ç®¡ç†å‘˜
                        device: loginDevice,
                        ip: ipAddress,
                        timestamp: new Date().getTime()
                    };
                    
                    storedLogs.push(logData);
                    
                    // åˆ é™¤è¡Œ
                    row.remove();
                });
                
                // ä¿å­˜æ‰€æœ‰æ—¥å¿—
                localStorage.setItem('systemLogs', JSON.stringify(storedLogs));
                
                // æ£€æŸ¥è¡¨æ ¼æ˜¯å¦ä¸ºç©º
                checkEmptyTable();
                
                // æ˜¾ç¤ºæ¶ˆæ¯
                alert(`å·²å¼ºåˆ¶ ${count} åç”¨æˆ·é€€å‡ºç™»å½•`);
            }
        }

        // æœç´¢ç”¨æˆ·å‡½æ•°
        function searchUser() {
            const email = document.querySelector('#add-user-modal input[name="email"]').value;
            // åŸæ¥å¯èƒ½æ˜¯:
            // const employeeId = document.querySelector('#add-user-modal input[name="employeeId"]').value;
            
            if (!email) {
                showSearchMessage('è¯·è¾“å…¥åŸŸè´¦å·', 'error');
                return;
            }
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            showSearchMessage('æ­£åœ¨æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯...', 'loading');
            
            // ä¿®æ”¹APIè°ƒç”¨å‚æ•°
            setTimeout(() => {
                // å‡è®¾è¿™æ˜¯æ¨¡æ‹Ÿä»åç«¯è·å–æ•°æ®
                const userData = {
                    name: 'å¼ ä¸‰',
                    email: email, // æ›¿æ¢åŸæ¥çš„ employeeId
                    department: 'ä¸­åœ‹å»ºç¯‰åœ‹éš›-ä¸­å»ºé¦™æ¸¯-æµ·å®æŠ€è¡“æœ‰é™å…¬å¸-æµ·å®å…¬å¸åœ˜éšŠ(é§æ·±)-æ•¸å­—åŒ–æå‡éƒ¨äºŒéƒ¨',
                    // å…¶ä»–ç”¨æˆ·æ•°æ®...
                };
                
                displayUserInfo(userData);
                showSearchMessage('ç”¨æˆ·ä¿¡æ¯å·²æ‰¾åˆ°', 'success');
            }, 1000);
        }

        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å‡½æ•°
        function displayUserInfo(user) {
            // ä¿®æ”¹æ˜¾ç¤ºå­—æ®µ
            document.querySelector('.user-details .name-value').textContent = user.name;
            document.querySelector('.user-details .email-value').textContent = user.email;
            // åŸæ¥å¯èƒ½æ˜¯:
            // document.querySelector('.user-details .employeeId-value').textContent = user.employeeId;
            document.querySelector('.user-details .department-value').textContent = user.department;
            // å…¶ä»–å­—æ®µ...
        }

        // æ·»åŠ ç”¨æˆ·å‡½æ•°
        function addUser() {
            // è·å–è¡¨å•æ•°æ®
            const name = document.querySelector('#add-user-modal input[name="name"]').value;
            const email = document.querySelector('#add-user-modal input[name="email"]').value;
            // åŸæ¥å¯èƒ½æ˜¯:
            // const employeeId = document.querySelector('#add-user-modal input[name="employeeId"]').value;
            const department = document.querySelector('#add-user-modal select[name="department"]').value;
            
            // è·å–å¹³å°å’Œè§’è‰² (ä¿®å¤ä¹‹å‰çš„é”™è¯¯)
            const platform = document.querySelector('#add-user-modal select[name="platform"]').value;
            const role = document.querySelector('#add-user-modal input[name="role"]:checked').value;
            
            // éªŒè¯
            if (!name || !email || !department || !platform || !role) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            // æ„å»ºç”¨æˆ·æ•°æ®
            const userData = {
                name,
                email,  // æ›¿æ¢åŸæ¥çš„ employeeId
                department,
                platform,
                role,
                // å…¶ä»–æ•°æ®...
            };
            
            // æäº¤æ•°æ®é€»è¾‘...
            console.log('æ·»åŠ ç”¨æˆ·:', userData);
            closeModal('add-user-modal');
            // åˆ·æ–°ç”¨æˆ·åˆ—è¡¨
            refreshUserList();
        }

        // ä¿®æ”¹åˆ†é¡µç»„ä»¶çš„å‡½æ•°
        function updatePaginationComponents() {
            // è·å–æ‰€æœ‰åˆ†é¡µç»„ä»¶
            const paginationElements = document.querySelectorAll('.pagination');
            
            paginationElements.forEach(pagination => {
                // åˆ›å»ºå¤–å±‚å®¹å™¨
                const paginationContainer = document.createElement('div');
                paginationContainer.className = 'pagination-container';
                
                // åˆ›å»ºé€‰æ‹©æ¯é¡µæ¡æ•°çš„é€‰æ‹©å™¨
                const paginationOptions = document.createElement('div');
                paginationOptions.className = 'pagination-options';
                paginationOptions.innerHTML = `
                  <span>æ¯é¡µæ˜¾ç¤º</span>
                  <select class="page-size-select">
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                  <span>æ¡</span>
                `;
                
                // å°†åˆ†é¡µç»„ä»¶æ›¿æ¢ä¸ºæ–°çš„ç»“æ„
                const parent = pagination.parentElement;
                parent.insertBefore(paginationContainer, pagination);
                
                // å°†åŸåˆ†é¡µç»„ä»¶å’Œé€‰æ‹©å™¨æ·»åŠ åˆ°æ–°å®¹å™¨ä¸­
                paginationContainer.appendChild(paginationOptions);
                paginationContainer.appendChild(pagination);
                
                // ä¸ºé€‰æ‹©å™¨æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                const pageSizeSelect = paginationOptions.querySelector('.page-size-select');
                pageSizeSelect.addEventListener('change', function() {
                  const pageSize = parseInt(this.value);
                  
                  // è·å–å½“å‰æ ‡ç­¾é¡µIDï¼Œä»¥ç¡®å®šæ˜¯å“ªä¸ªè¡¨æ ¼
                  let tabId = '';
                  const tabContent = findParentWithClass(pagination, 'tab-content');
                  if (tabContent) {
                    tabId = tabContent.id;
                  }
                  
                  // å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œåº”è¯¥è°ƒç”¨åŠ è½½æ•°æ®çš„å‡½æ•°é‡æ–°åŠ è½½å¯¹åº”é¡µæ•°çš„æ•°æ®
                  console.log(`åˆ‡æ¢ ${tabId} çš„æ¯é¡µæ¡æ•°ä¸º ${pageSize} æ¡`);
                  
                  // æ¨¡æ‹Ÿåˆ‡æ¢é¡µç  - å®é™…å®ç°ä¸­åº”è¯¥è°ƒç”¨åŠ è½½æ•°æ®çš„å‡½æ•°
                  simulatePageSizeChange(tabId, pageSize);
                });
            });
        }

        // æ ¹æ®å…ƒç´ æŸ¥æ‰¾å…·æœ‰æŒ‡å®šç±»åçš„çˆ¶å…ƒç´ 
        function findParentWithClass(element, className) {
            let parent = element.parentElement;
            while (parent) {
                if (parent.classList.contains(className)) {
                    return parent;
                }
                parent = parent.parentElement;
            }
            return null;
        }

        // æ¨¡æ‹Ÿé¡µç åˆ‡æ¢ - åœ¨çœŸå®å®ç°ä¸­åº”æ›¿æ¢ä¸ºå®é™…çš„æ•°æ®åŠ è½½å‡½æ•°
        function simulatePageSizeChange(tabId, pageSize) {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥è°ƒç”¨APIé‡æ–°åŠ è½½æ•°æ®
            // è¿™é‡Œåªæ˜¯ç®€å•åœ°æ¨¡æ‹Ÿåˆ‡æ¢é¡µç åçš„æ•ˆæœ
            
            // æ›´æ–°å½“å‰æ´»åŠ¨çš„é¡µç æŒ‰é’®
            const paginationButtons = document.querySelectorAll(`#${tabId} .pagination button`);
            paginationButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            if (paginationButtons.length > 1) {
                paginationButtons[1].classList.add('active');
            }
            
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ä¸€äº›è§†è§‰åé¦ˆï¼Œä¾‹å¦‚è¡¨æ ¼loadingçŠ¶æ€ç­‰
            const table = document.querySelector(`#${tabId} table`);
            if (table) {
                table.style.opacity = '0.6';
                setTimeout(() => {
                    table.style.opacity = '1';
                }, 500);
            }
            
            // æ›´æ–°è¡¨æ ¼ä¸­æ˜¾ç¤ºçš„è®°å½•æ•°é‡
            // å®é™…åº”ç”¨ä¸­ï¼Œè¿™åº”è¯¥ç”±é‡æ–°åŠ è½½çš„æ•°æ®å†³å®š
            updateTableRows(tabId, pageSize);
        }

        // æ›´æ–°è¡¨æ ¼è¡Œæ•°
        function updateTableRows(tabId, pageSize) {
            const tbody = document.querySelector(`#${tabId} table tbody`);
            if (!tbody) return;
            
            const rows = tbody.querySelectorAll('tr');
            
            // æ˜¾ç¤ºæ‰€æœ‰è¡Œï¼Œç„¶åæ ¹æ®pageSizeéšè—å¤šä½™çš„è¡Œ
            rows.forEach((row, index) => {
                if (index < pageSize) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // å¤„ç†è§’è‰²å˜æ›´
        function handleRoleChange() {
            // æ£€æŸ¥å½“å‰é€‰æ‹©çš„è§’è‰²æ˜¯å¦ä¸ºå¹³å°ç®¡ç†å‘˜
            const isPlatformAdmin = document.querySelector('#add-user-modal input[name="role"][value="platform-admin"]').checked;
            
            // æ‰¾åˆ°ç®¡ç†å¹³å°è¡¨å•ç»„
            const managePlatformGroup = document.querySelector('#manage-platform-select').closest('.form-group');
            
            console.log('è§’è‰²å˜æ›´:', isPlatformAdmin ? 'å¹³å°ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·');
            console.log('ç®¡ç†å¹³å°è¡¨å•ç»„:', managePlatformGroup);
            
            // æ ¹æ®è§’è‰²è®¾ç½®æ˜¾ç¤º/éšè—
            if (isPlatformAdmin) {
                managePlatformGroup.style.display = 'block';
                managePlatformGroup.style.opacity = '1';
                managePlatformGroup.style.visibility = 'visible';
                console.log('æ˜¾ç¤ºç®¡ç†å¹³å°é€‰æ‹©æ¡†');
            } else {
                managePlatformGroup.style.display = 'none';
                console.log('éšè—ç®¡ç†å¹³å°é€‰æ‹©æ¡†');
            }
        }
        
        // åˆå§‹åŒ–ç®¡ç†å¹³å°å¤šé€‰ä¸‹æ‹‰æ¡†
        function initManagePlatformSelect() {
            const platformSelect = document.querySelector('#manage-platform-select');
            if (!platformSelect) return;
            
            const header = platformSelect.querySelector('.multi-select-header');
            const dropdown = platformSelect.querySelector('.multi-select-dropdown');
            const options = platformSelect.querySelectorAll('.multi-select-option input');
            const headerText = header.querySelector('span');
            
            // é»˜è®¤éšè—ç®¡ç†å¹³å°é€‰é¡¹ï¼ˆé™¤éç”¨æˆ·æ˜¯å¹³å°ç®¡ç†å‘˜ï¼‰
            handleRoleChange();
            
            // åˆ‡æ¢ä¸‹æ‹‰æ¡†æ˜¾ç¤º
            header.addEventListener('click', (e) => {
                e.stopPropagation();
                
                // å…³é—­å…¶ä»–æ‰“å¼€çš„ä¸‹æ‹‰æ¡†
                document.querySelectorAll('.multi-select-dropdown.active').forEach(d => {
                    if (d !== dropdown) {
                        d.classList.remove('active');
                        d.closest('.multi-select').querySelector('.multi-select-header').classList.remove('active');
                    }
                });
                
                // åˆ‡æ¢å½“å‰ä¸‹æ‹‰æ¡†
                dropdown.classList.toggle('active');
                header.classList.toggle('active');
            });
            
            // å¤„ç†é€‰é¡¹é€‰æ‹©
            options.forEach(option => {
                option.addEventListener('change', (e) => {
                    e.stopPropagation();
                    updateManagePlatformHeaderText(platformSelect);
                });
                
                // é˜²æ­¢ç‚¹å‡»é€‰é¡¹æ—¶å…³é—­ä¸‹æ‹‰æ¡†
                option.parentElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            });
            
            // åˆå§‹åŒ–æ ‡é¢˜æ–‡æœ¬
            updateManagePlatformHeaderText(platformSelect);
        }
        
        // æ›´æ–°ç®¡ç†å¹³å°ä¸‹æ‹‰æ¡†æ ‡é¢˜æ–‡æœ¬
        function updateManagePlatformHeaderText(select) {
            const header = select.querySelector('.multi-select-header span');
            const options = select.querySelectorAll('.multi-select-option input');
            const selectedOptions = Array.from(options).filter(opt => opt.checked);
            
            if (selectedOptions.length === 0) {
                header.textContent = 'è¯·é€‰æ‹©ç®¡ç†å¹³å°';
            } else if (selectedOptions.length === options.length) {
                header.textContent = 'ç®¡ç†æ‰€æœ‰å¹³å°';
            } else if (selectedOptions.length <= 2) {
                const labels = selectedOptions.map(opt => {
                    const text = opt.parentElement.textContent.trim();
                    return text;
                });
                header.textContent = labels.join(', ');
            } else {
                header.textContent = `å·²é€‰ ${selectedOptions.length} ä¸ªå¹³å°`;
            }
        }

        // åœ¨é¡µé¢åŠ è½½æ—¶ä¸ºç®¡ç†å¹³å°å¤šé€‰æ¡†æ·»åŠ æ ·å¼å’Œäº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // å·²æœ‰çš„äº‹ä»¶å¤„ç†...
            
            // ç¡®ä¿ç®¡ç†å¹³å°å¤šé€‰æ¡†æ ·å¼æ­£ç¡®
            const managePlatformSelect = document.querySelector('#manage-platform-select');
            if (managePlatformSelect) {
                console.log('åˆå§‹åŒ–ç®¡ç†å¹³å°å¤šé€‰æ¡†æ ·å¼');
                
                // ç¡®ä¿ä¸‹æ‹‰æ¡†çš„ç›¸å¯¹å®šä½
                managePlatformSelect.style.position = 'relative';
                
                // ç¡®ä¿å¤šé€‰æ¡†ä¸‹æ‹‰èœå•çš„å®½åº¦ä¸å¤´éƒ¨ä¸€è‡´
                const dropdown = managePlatformSelect.querySelector('.multi-select-dropdown');
                if (dropdown) {
                    dropdown.style.width = '100%';
                }
            }
        });

        // ç”¨äºæµ‹è¯•çš„è¾…åŠ©å‡½æ•°
        function toggleManagePlatform() {
            const managePlatformGroup = document.querySelector('#manage-platform-select').closest('.form-group');
            const currentDisplay = managePlatformGroup.style.display;
            
            if (currentDisplay === 'none') {
                managePlatformGroup.style.display = 'block';
                document.getElementById('manage-platform-status').textContent = 'çŠ¶æ€: æ˜¾ç¤º';
            } else {
                managePlatformGroup.style.display = 'none';
                document.getElementById('manage-platform-status').textContent = 'çŠ¶æ€: éšè—';
            }
        }

        // æ·»åŠ DOMè§‚å¯Ÿå™¨ä»¥ç›‘å¬æ¨¡æ€æ¡†çš„çŠ¶æ€å˜åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å·²æœ‰çš„äº‹ä»¶å¤„ç†...
            
            // åˆ›å»ºæ¨¡æ€æ¡†å¯è§æ€§å˜åŒ–è§‚å¯Ÿå™¨
            const modalObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === 'style') {
                        const modal = document.getElementById('add-user-modal');
                        const isModalVisible = modal.style.display === 'flex';
                        
                        if (isModalVisible) {
                            console.log('æ¨¡æ€æ¡†æ˜¾ç¤ºäº†ï¼Œç¡®ä¿ç®¡ç†å¹³å°å¤šé€‰æ¡†çŠ¶æ€æ­£ç¡®');
                            
                            // ç¡®ä¿è§’è‰²é€‰æ‹©æ­£ç¡®åˆå§‹åŒ–
                            setTimeout(() => {
                                // ç¡®ä¿æ™®é€šç”¨æˆ·å•é€‰æŒ‰é’®é€‰ä¸­
                                const userRoleRadio = document.querySelector('#add-user-modal input[name="role"][value="user"]');
                                if (userRoleRadio && !userRoleRadio.checked) {
                                    userRoleRadio.checked = true;
                                }
                                
                                // æ‰‹åŠ¨è§¦å‘è§’è‰²å˜æ›´å¤„ç†
                                handleRoleChange();
                                
                                // å¼ºåˆ¶è®¾ç½®ç®¡ç†å¹³å°ç»„çš„æ ·å¼
                                const managePlatformGroup = document.querySelector('#manage-platform-select').closest('.form-group');
                                if (managePlatformGroup) {
                                    // å¦‚æœæ˜¯å¹³å°ç®¡ç†å‘˜åˆ™æ˜¾ç¤ºï¼Œå¦åˆ™éšè—
                                    const isPlatformAdmin = document.querySelector('#add-user-modal input[name="role"][value="platform-admin"]').checked;
                                    managePlatformGroup.style.display = isPlatformAdmin ? 'block' : 'none';
                                    console.log('è®¾ç½®ç®¡ç†å¹³å°å¤šé€‰æ¡†çŠ¶æ€:', isPlatformAdmin ? 'æ˜¾ç¤º' : 'éšè—');
                                }
                            }, 200);
                        }
                    }
                });
            });
            
            // è§‚å¯Ÿæ¨¡æ€æ¡†çš„styleå±æ€§å˜åŒ–
            const modal = document.getElementById('add-user-modal');
            if (modal) {
                modalObserver.observe(modal, { attributes: true, attributeFilter: ['style'] });
            }
        });
    </script>
</body>
</html> 
